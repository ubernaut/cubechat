(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PPubsubPeerDiscovery = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PPubsubPeerDiscovery=(()=>{var kr=Object.defineProperty;var Zi=Object.getOwnPropertyDescriptor;var Fi=Object.getOwnPropertyNames;var Gi=Object.prototype.hasOwnProperty;var dt=(e,t)=>{for(var r in t)kr(e,r,{get:t[r],enumerable:!0})},$i=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Fi(t))!Gi.call(e,o)&&o!==r&&kr(e,o,{get:()=>t[o],enumerable:!(n=Zi(t,o))||n.enumerable});return e};var ji=e=>$i(kr({},"__esModule",{value:!0}),e);var xu={};dt(xu,{PubSubPeerDiscovery:()=>Nr,TOPIC:()=>zi,pubsubPeerDiscovery:()=>gu});var J=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},ce=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var fe=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Lo=Symbol.for("@libp2p/peer-discovery");var Mr=Symbol.for("@libp2p/peer-id");var nr=class extends EventTarget{#t=new Map;constructor(){super()}listenerCount(t){let r=this.#t.get(t);return r==null?0:r.length}addEventListener(t,r,n){super.addEventListener(t,r,n);let o=this.#t.get(t);o==null&&(o=[],this.#t.set(t,o)),o.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(t,r,n){super.removeEventListener(t.toString(),r??null,n);let o=this.#t.get(t);o!=null&&(o=o.filter(({callback:s})=>s!==r),this.#t.set(t,o))}dispatchEvent(t){let r=super.dispatchEvent(t),n=this.#t.get(t.type);return n==null||(n=n.filter(({once:o})=>!o),this.#t.set(t.type,n)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}};var Zr={};dt(Zr,{base58btc:()=>W,base58flickr:()=>ea});var Bu=new Uint8Array(0);function Ro(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Ct(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Ko(e){return new TextEncoder().encode(e)}function Oo(e){return new TextDecoder().decode(e)}function Yi(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,a=e.charAt(0),f=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function u(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var B=0,A=0,y=0,v=m.length;y!==v&&m[y]===0;)y++,B++;for(var b=(v-y)*d+1>>>0,I=new Uint8Array(b);y!==v;){for(var K=m[y],N=0,k=b-1;(K!==0||N<A)&&k!==-1;k--,N++)K+=256*I[k]>>>0,I[k]=K%c>>>0,K=K/c>>>0;if(K!==0)throw new Error("Non-zero carry");A=N,y++}for(var x=b-A;x!==b&&I[x]===0;)x++;for(var g=a.repeat(B);x<b;++x)g+=e.charAt(I[x]);return g}function w(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var B=0;if(m[B]!==" "){for(var A=0,y=0;m[B]===a;)A++,B++;for(var v=(m.length-B)*f+1>>>0,b=new Uint8Array(v);m[B];){var I=r[m.charCodeAt(B)];if(I===255)return;for(var K=0,N=v-1;(I!==0||K<y)&&N!==-1;N--,K++)I+=c*b[N]>>>0,b[N]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");y=K,B++}if(m[B]!==" "){for(var k=v-y;k!==v&&b[k]===0;)k++;for(var x=new Uint8Array(A+(v-k)),g=A;k!==v;)x[g++]=b[k++];return x}}}function S(m){var B=w(m);if(B)return B;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:w,decode:S}}var Wi=Yi,Xi=Wi,Uo=Xi;var Vr=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},qr=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return No(this,t)}},Hr=class{decoders;constructor(t){this.decoders=t}or(t){return No(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function No(e,t){return new Hr({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var zr=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Vr(t,r,n),this.decoder=new qr(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function ue({name:e,prefix:t,encode:r,decode:n}){return new zr(e,t,r,n)}function qt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Uo(r,e);return ue({prefix:t,name:e,encode:n,decode:s=>Ct(o(s))})}function Ji(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,c=0,a=0;for(let f=0;f<o;++f){let d=t[e[f]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|d,i+=r,i>=8&&(i-=8,s[a++]=255&c>>i)}if(i>=r||(255&c<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Qi(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let a=0;a<e.length;++a)for(c=c<<8|e[a],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function ta(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function Y({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=ta(n);return ue({prefix:t,name:e,encode(s){return Qi(s,n,r)},decode(s){return Ji(s,o,r,e)}})}var W=qt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ea=qt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Fr={};dt(Fr,{base32:()=>Ht,base32hex:()=>sa,base32hexpad:()=>aa,base32hexpadupper:()=>ca,base32hexupper:()=>ia,base32pad:()=>na,base32padupper:()=>oa,base32upper:()=>ra,base32z:()=>fa});var Ht=Y({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ra=Y({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),na=Y({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oa=Y({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sa=Y({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ia=Y({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aa=Y({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ca=Y({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fa=Y({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Gr={};dt(Gr,{base36:()=>Re,base36upper:()=>ua});var Re=qt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ua=qt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var la=Vo,ko=128,da=127,ha=~da,pa=Math.pow(2,31);function Vo(e,t,r){t=t||[],r=r||0;for(var n=r;e>=pa;)t[r++]=e&255|ko,e/=128;for(;e&ha;)t[r++]=e&255|ko,e>>>=7;return t[r]=e|0,Vo.bytes=r-n+1,t}var ma=$r,ya=128,Mo=127;function $r(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw $r.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Mo)<<o:(i&Mo)*Math.pow(2,o),o+=7}while(i>=ya);return $r.bytes=s-n,r}var ba=Math.pow(2,7),ga=Math.pow(2,14),xa=Math.pow(2,21),wa=Math.pow(2,28),Ea=Math.pow(2,35),Sa=Math.pow(2,42),Aa=Math.pow(2,49),va=Math.pow(2,56),Ba=Math.pow(2,63),Ia=function(e){return e<ba?1:e<ga?2:e<xa?3:e<wa?4:e<Ea?5:e<Sa?6:e<Aa?7:e<va?8:e<Ba?9:10},_a={encode:la,decode:ma,encodingLength:Ia},Ca=_a,Ke=Ca;function Oe(e,t=0){return[Ke.decode(e,t),Ke.decode.bytes]}function le(e,t,r=0){return Ke.encode(e,t,r),t}function de(e){return Ke.encodingLength(e)}function At(e,t){let r=t.byteLength,n=de(e),o=n+de(r),s=new Uint8Array(o+r);return le(e,s,0),le(r,s,n),s.set(t,o),new he(e,r,t,s)}function jr(e){let t=Ct(e),[r,n]=Oe(t),[o,s]=Oe(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new he(r,o,i,t)}function qo(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Ro(e.bytes,r.bytes)}}var he=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Ho(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Ta(r,Yr(e),t??W.encoder);default:return La(r,Yr(e),t??Ht.encoder)}}var zo=new WeakMap;function Yr(e){let t=zo.get(e);if(t==null){let r=new Map;return zo.set(e,r),r}return t}var Q=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Pe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Ra)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=At(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&qo(t.multihash,n.multihash)}toString(t){return Ho(this,t)}toJSON(){return{"/":Ho(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Zo(n,o,s.bytes))}else if(r[Ka]===!0){let{version:n,multihash:o,code:s}=r,i=jr(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Pe)throw new Error(`Version 0 CID must use dag-pb (code: ${Pe}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Zo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Pe,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Ct(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new he(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[u,w]=Oe(t.subarray(r));return r+=w,u},o=n(),s=Pe;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),a=n(),f=r+a,d=f-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:d,size:f}}static parse(t,r){let[n,o]=Da(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Yr(s).set(n,t),s}};function Da(e,t){switch(e[0]){case"Q":{let r=t??W;return[W.prefix,r.decode(`${W.prefix}${e}`)]}case W.prefix:{let r=t??W;return[W.prefix,r.decode(e)]}case Ht.prefix:{let r=t??Ht;return[Ht.prefix,r.decode(e)]}case Re.prefix:{let r=t??Re;return[Re.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Ta(e,t,r){let{prefix:n}=r;if(n!==W.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function La(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Pe=112,Ra=18;function Zo(e,t,r){let n=de(e),o=n+de(t),s=new Uint8Array(o+r.byteLength);return le(e,s,0),le(t,s,n),s.set(r,o),s}var Ka=Symbol.for("@ipld/js-cid/CID");var Wr={};dt(Wr,{identity:()=>vt});var Fo=0,Oa="identity",Go=Ct;function Pa(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return At(Fo,Go(e))}var vt={code:Fo,name:Oa,encode:Go,digest:Pa};function ct(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function xt(e=0){return new Uint8Array(e)}function mt(e=0){return new Uint8Array(e)}function Dt(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=mt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var jo=Symbol.for("@achingbrain/uint8arraylist");function $o(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function sr(e){return!!e?.[jo]}var yt=class e{bufs;length;[jo]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(sr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(sr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=$o(this.bufs,t);return r.buf[r.index]}set(t,r){let n=$o(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(sr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Dt(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Dt(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let f=t>=c&&t<a,d=r>c&&r<=a;if(f&&d){if(t===c&&r===a){n.push(i);break}let u=t-c;n.push(i.subarray(u,u+(r-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(d){if(r===a){n.push(i);break}n.push(i.subarray(0,r-c));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!sr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<o;u++)i[n[u]]=u;let c=i,a=this.byteLength-n.byteLength,f=n.byteLength-1,d;for(let u=r;u<=a;u+=d){d=0;for(let w=f;w>=0;w--){let S=this.get(u+w);if(n[w]!==S){d=Math.max(1,w-c[S]);break}}if(d===0)return u}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=mt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=xt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=xt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=xt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=mt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=xt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=xt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=xt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=xt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=xt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ct(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var Xr={};dt(Xr,{base10:()=>Ua});var Ua=qt({prefix:"9",name:"base10",alphabet:"0123456789"});var Jr={};dt(Jr,{base16:()=>Na,base16upper:()=>ka});var Na=Y({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ka=Y({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Qr={};dt(Qr,{base2:()=>Ma});var Ma=Y({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var tn={};dt(tn,{base256emoji:()=>Za});var Yo=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Va=Yo.reduce((e,t,r)=>(e[r]=t,e),[]),qa=Yo.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function Ha(e){return e.reduce((t,r)=>(t+=Va[r],t),"")}function za(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=qa[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var Za=ue({prefix:"\u{1F680}",name:"base256emoji",encode:Ha,decode:za});var rn={};dt(rn,{base64:()=>Fa,base64pad:()=>Ga,base64url:()=>en,base64urlpad:()=>$a});var Fa=Y({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ga=Y({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),en=Y({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$a=Y({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var nn={};dt(nn,{base8:()=>ja});var ja=Y({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var on={};dt(on,{identity:()=>Ya});var Ya=ue({prefix:"\0",name:"identity",encode:e=>Oo(e),decode:e=>Ko(e)});var cl=new TextEncoder,fl=new TextDecoder;var cn={};dt(cn,{sha256:()=>ir,sha512:()=>Qa});var Ja=20;function an({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new sn(e,t,r,n,o)}var sn=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??Ja,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Wo(n,this.code,r?.truncate):n.then(o=>Wo(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Wo(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return At(t,e)}function Jo(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var ir=an({name:"sha2-256",code:18,encode:Jo("SHA-256")}),Qa=an({name:"sha2-512",code:19,encode:Jo("SHA-512")});var Ue={...on,...Qr,...nn,...Xr,...Jr,...Fr,...Gr,...Zr,...rn,...tn},El={...cn,...Wr};function ts(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Qo=ts("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),fn=ts("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=mt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),tc={utf8:Qo,"utf-8":Qo,hex:Ue.base16,latin1:fn,ascii:fn,binary:fn,...Ue},ar=tc;function H(e,t="utf8"){let r=ar[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function q(e,t="utf8"){let r=ar[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var ec=parseInt("11111",2),un=parseInt("10000000",2),rc=parseInt("01111111",2),es={0:Ne,1:Ne,2:nc,3:ic,4:ac,5:sc,6:oc,16:Ne,22:Ne,48:Ne};function Tt(e,t={offset:0}){let r=e[t.offset]&ec;if(t.offset++,es[r]!=null)return es[r](e,t);throw new Error("No decoder for tag "+r)}function ke(e,t){let r=0;if((e[t.offset]&un)===un){let n=e[t.offset]&rc,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Ne(e,t){ke(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=Tt(e,t);if(n===null)break;r.push(n)}return r}function nc(e,t){let r=ke(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function oc(e,t){let r=ke(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let f=e[t.offset];if(t.offset++,a.push(f&127),f<128){a.reverse();let d=0;for(let u=0;u<a.length;u++)d+=a[u]<<u*7;c+=`.${d}`,a=[]}}return c}function sc(e,t){return t.offset++,null}function ic(e,t){let r=ke(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function ac(e,t){let r=ke(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function cc(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new yt;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function ln(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=cc(e.byteLength);return new yt(Uint8Array.from([t.byteLength|un]),t)}function ht(e){let t=new yt,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new yt(Uint8Array.from([2]),ln(t),t)}function cr(e){let t=Uint8Array.from([0]),r=new yt(t,e);return new yt(Uint8Array.from([3]),ln(r),r)}function zt(e,t=48){let r=new yt;for(let n of e)r.append(n);return new yt(Uint8Array.from([t]),ln(r),r)}async function rs(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var fc=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),uc=Uint8Array.from([6,5,43,129,4,0,34]),lc=Uint8Array.from([6,5,43,129,4,0,35]),dc={ext:!0,kty:"EC",crv:"P-256"},hc={ext:!0,kty:"EC",crv:"P-384"},pc={ext:!0,kty:"EC",crv:"P-521"},dn=32,hn=48,pn=66;function ns(e){let t=Tt(e);return os(t)}function os(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===dn*2+1)return n=q(t.subarray(r,r+dn),"base64url"),o=q(t.subarray(r+dn),"base64url"),new me({...dc,key_ops:["verify"],x:n,y:o});if(t.byteLength===hn*2+1)return n=q(t.subarray(r,r+hn),"base64url"),o=q(t.subarray(r+hn),"base64url"),new me({...hc,key_ops:["verify"],x:n,y:o});if(t.byteLength===pn*2+1)return n=q(t.subarray(r,r+pn),"base64url"),o=q(t.subarray(r+pn),"base64url"),new me({...pc,key_ops:["verify"],x:n,y:o});throw new J(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function ss(e){return zt([ht(Uint8Array.from([1])),zt([mc(e.crv)],160),zt([cr(new yt(Uint8Array.from([4]),H(e.x??"","base64url"),H(e.y??"","base64url")))],161)]).subarray()}function mc(e){if(e==="P-256")return fc;if(e==="P-384")return uc;if(e==="P-521")return lc;throw new J(`Invalid curve ${e}`)}var me=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=ss(this.jwk)),this._raw}toMultihash(){return vt.digest(Zt(this))}toCID(){return Q.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}async verify(t,r,n){return rs(this.jwk,r,t,n)}};function Jt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Bt(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function U(e,t,r=""){let n=Jt(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,c=s?` of length ${t}`:"",a=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function fr(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Bt(e.outputLen),Bt(e.blockLen)}function ye(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function as(e,t){U(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function Rt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ur(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function wt(e,t){return e<<32-t|e>>>t}var cs=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",yc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Kt(e){if(U(e),cs)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=yc[e[r]];return t}var Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function is(e){if(e>=Lt._0&&e<=Lt._9)return e-Lt._0;if(e>=Lt.A&&e<=Lt.F)return e-(Lt.A-10);if(e>=Lt.a&&e<=Lt.f)return e-(Lt.a-10)}function Ot(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(cs)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=is(e.charCodeAt(s)),c=is(e.charCodeAt(s+1));if(i===void 0||c===void 0){let a=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function pt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];U(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function mn(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function be(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var yn=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function fs(e,t,r){return e&t^~e&r}function us(e,t,r){return e&t^e&r^t&r}var Me=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=ur(this.buffer)}update(t){ye(this),U(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=ur(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ye(this),as(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Rt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let u=i;u<o;u++)r[u]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let c=ur(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let f=a/4,d=this.get();if(f>d.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,d[u],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Pt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var st=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var lr=BigInt(4294967295),ls=BigInt(32);function bc(e,t=!1){return t?{h:Number(e&lr),l:Number(e>>ls&lr)}:{h:Number(e>>ls&lr)|0,l:Number(e&lr)|0}}function ds(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=bc(e[s],t);[n[s],o[s]]=[i,c]}return[n,o]}var bn=(e,t,r)=>e>>>r,gn=(e,t,r)=>e<<32-r|t>>>r,Qt=(e,t,r)=>e>>>r|t<<32-r,te=(e,t,r)=>e<<32-r|t>>>r,Ve=(e,t,r)=>e<<64-r|t>>>r-32,qe=(e,t,r)=>e>>>r-32|t<<64-r;function It(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var hs=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),ps=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,ms=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),ys=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,bs=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),gs=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var xc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64),xn=class extends Me{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,r,n,o,s,i,c,a]}set(t,r,n,o,s,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let u=0;u<16;u++,r+=4)Ft[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let w=Ft[u-15],S=Ft[u-2],m=wt(w,7)^wt(w,18)^w>>>3,B=wt(S,17)^wt(S,19)^S>>>10;Ft[u]=B+Ft[u-7]+m+Ft[u-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:f,H:d}=this;for(let u=0;u<64;u++){let w=wt(c,6)^wt(c,11)^wt(c,25),S=d+w+fs(c,a,f)+xc[u]+Ft[u]|0,B=(wt(n,2)^wt(n,13)^wt(n,22))+us(n,o,s)|0;d=f,f=a,a=c,c=i+S|0,i=s,s=o,o=n,n=S+B|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,d=d+this.H|0,this.set(n,o,s,i,c,a,f,d)}roundClean(){Rt(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),Rt(this.buffer)}},wn=class extends xn{A=Pt[0]|0;B=Pt[1]|0;C=Pt[2]|0;D=Pt[3]|0;E=Pt[4]|0;F=Pt[5]|0;G=Pt[6]|0;H=Pt[7]|0;constructor(){super(32)}};var xs=ds(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),wc=xs[0],Ec=xs[1],Gt=new Uint32Array(80),$t=new Uint32Array(80),En=class extends Me{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:f,El:d,Fh:u,Fl:w,Gh:S,Gl:m,Hh:B,Hl:A}=this;return[t,r,n,o,s,i,c,a,f,d,u,w,S,m,B,A]}set(t,r,n,o,s,i,c,a,f,d,u,w,S,m,B,A){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=f|0,this.El=d|0,this.Fh=u|0,this.Fl=w|0,this.Gh=S|0,this.Gl=m|0,this.Hh=B|0,this.Hl=A|0}process(t,r){for(let b=0;b<16;b++,r+=4)Gt[b]=t.getUint32(r),$t[b]=t.getUint32(r+=4);for(let b=16;b<80;b++){let I=Gt[b-15]|0,K=$t[b-15]|0,N=Qt(I,K,1)^Qt(I,K,8)^bn(I,K,7),k=te(I,K,1)^te(I,K,8)^gn(I,K,7),x=Gt[b-2]|0,g=$t[b-2]|0,O=Qt(x,g,19)^Ve(x,g,61)^bn(x,g,6),M=te(x,g,19)^qe(x,g,61)^gn(x,g,6),T=ms(k,M,$t[b-7],$t[b-16]),h=ys(T,N,O,Gt[b-7],Gt[b-16]);Gt[b]=h|0,$t[b]=T|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:f,Dl:d,Eh:u,El:w,Fh:S,Fl:m,Gh:B,Gl:A,Hh:y,Hl:v}=this;for(let b=0;b<80;b++){let I=Qt(u,w,14)^Qt(u,w,18)^Ve(u,w,41),K=te(u,w,14)^te(u,w,18)^qe(u,w,41),N=u&S^~u&B,k=w&m^~w&A,x=bs(v,K,k,Ec[b],$t[b]),g=gs(x,y,I,N,wc[b],Gt[b]),O=x|0,M=Qt(n,o,28)^Ve(n,o,34)^Ve(n,o,39),T=te(n,o,28)^qe(n,o,34)^qe(n,o,39),h=n&s^n&c^s&c,p=o&i^o&a^i&a;y=B|0,v=A|0,B=S|0,A=m|0,S=u|0,m=w|0,{h:u,l:w}=It(f|0,d|0,g|0,O|0),f=c|0,d=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let l=hs(O,T,p);n=ps(l,g,M,h),o=l|0}({h:n,l:o}=It(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=It(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=It(this.Ch|0,this.Cl|0,c|0,a|0),{h:f,l:d}=It(this.Dh|0,this.Dl|0,f|0,d|0),{h:u,l:w}=It(this.Eh|0,this.El|0,u|0,w|0),{h:S,l:m}=It(this.Fh|0,this.Fl|0,S|0,m|0),{h:B,l:A}=It(this.Gh|0,this.Gl|0,B|0,A|0),{h:y,l:v}=It(this.Hh|0,this.Hl|0,y|0,v|0),this.set(n,o,s,i,c,a,f,d,u,w,S,m,B,A,y,v)}roundClean(){Rt(Gt,$t)}destroy(){Rt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Sn=class extends En{Ah=st[0]|0;Al=st[1]|0;Bh=st[2]|0;Bl=st[3]|0;Ch=st[4]|0;Cl=st[5]|0;Dh=st[6]|0;Dl=st[7]|0;Eh=st[8]|0;El=st[9]|0;Fh=st[10]|0;Fl=st[11]|0;Gh=st[12]|0;Gl=st[13]|0;Hh=st[14]|0;Hl=st[15]|0;constructor(){super(64)}};var ge=mn(()=>new wn,yn(1));var ws=mn(()=>new Sn,yn(3));var vn=BigInt(0),An=BigInt(1);function Ut(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Es(e){if(typeof e=="bigint"){if(!dr(e))throw new Error("positive bigint expected, got "+e)}else Bt(e);return e}function He(e){let t=Es(e).toString(16);return t.length&1?"0"+t:t}function Ss(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?vn:BigInt("0x"+e)}function xe(e){return Ss(Kt(e))}function ee(e){return Ss(Kt(pr(U(e)).reverse()))}function hr(e,t){Bt(t),e=Es(e);let r=Ot(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Bn(e,t){return hr(e,t).reverse()}function pr(e){return Uint8Array.from(e)}var dr=e=>typeof e=="bigint"&&vn<=e;function Sc(e,t,r){return dr(e)&&dr(t)&&dr(r)&&t<=e&&e<r}function ze(e,t,r,n){if(!Sc(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function In(e){let t;for(t=0;e>vn;e>>=An,t+=1);return t}var Ze=e=>(An<<BigInt(e))-An;function As(e,t,r){if(Bt(e,"hashLen"),Bt(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=A=>new Uint8Array(A),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),c=1e3,a=n(e),f=n(e),d=0,u=()=>{a.fill(1),f.fill(0),d=0},w=(...A)=>r(f,pt(a,...A)),S=(A=o)=>{f=w(s,A),a=w(),A.length!==0&&(f=w(i,A),a=w())},m=()=>{if(d++>=c)throw new Error("drbg: tried max amount of iterations");let A=0,y=[];for(;A<t;){a=w();let v=a.slice();y.push(v),A+=a.length}return pt(...y)};return(A,y)=>{u(),S(A);let v;for(;!(v=y(m()));)S();return u(),v}}function jt(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,c){let a=e[s];if(c&&a===void 0)return;let f=typeof a;if(f!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${f}`)}let o=(s,i)=>Object.entries(s).forEach(([c,a])=>n(c,a,i));o(t,!1),o(r,!0)}function we(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var lt=BigInt(0),tt=BigInt(1),re=BigInt(2),Is=BigInt(3),_s=BigInt(4),Cs=BigInt(5),Ac=BigInt(7),Ds=BigInt(8),vc=BigInt(9),Ts=BigInt(16);function X(e,t){let r=e%t;return r>=lt?r:t+r}function Z(e,t,r){let n=e;for(;t-- >lt;)n*=n,n%=r;return n}function vs(e,t){if(e===lt)throw new Error("invert: expected non-zero number");if(t<=lt)throw new Error("invert: expected positive modulus, got "+t);let r=X(e,t),n=t,o=lt,s=tt,i=tt,c=lt;for(;r!==lt;){let f=n/r,d=n%r,u=o-i*f,w=s-c*f;n=r,r=d,o=i,s=c,i=u,c=w}if(n!==tt)throw new Error("invert: does not exist");return X(o,t)}function Cn(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Ls(e,t){let r=(e.ORDER+tt)/_s,n=e.pow(t,r);return Cn(e,n,t),n}function Bc(e,t){let r=(e.ORDER-Cs)/Ds,n=e.mul(t,re),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,re),o),c=e.mul(s,e.sub(i,e.ONE));return Cn(e,c,t),c}function Ic(e){let t=Ee(e),r=Rs(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+Ac)/Ts;return(c,a)=>{let f=c.pow(a,i),d=c.mul(f,n),u=c.mul(f,o),w=c.mul(f,s),S=c.eql(c.sqr(d),a),m=c.eql(c.sqr(u),a);f=c.cmov(f,d,S),d=c.cmov(w,u,m);let B=c.eql(c.sqr(d),a),A=c.cmov(f,d,B);return Cn(c,A,a),A}}function Rs(e){if(e<Is)throw new Error("sqrt is not defined for small field");let t=e-tt,r=0;for(;t%re===lt;)t/=re,r++;let n=re,o=Ee(e);for(;Bs(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ls;let s=o.pow(n,t),i=(t+tt)/re;return function(a,f){if(a.is0(f))return f;if(Bs(a,f)!==1)throw new Error("Cannot find square root");let d=r,u=a.mul(a.ONE,s),w=a.pow(f,t),S=a.pow(f,i);for(;!a.eql(w,a.ONE);){if(a.is0(w))return a.ZERO;let m=1,B=a.sqr(w);for(;!a.eql(B,a.ONE);)if(m++,B=a.sqr(B),m===d)throw new Error("Cannot find square root");let A=tt<<BigInt(d-m-1),y=a.pow(u,A);d=m,u=a.sqr(y),w=a.mul(w,u),S=a.mul(S,y)}return S}}function _c(e){return e%_s===Is?Ls:e%Ds===Cs?Bc:e%Ts===vc?Ic(e):Rs(e)}var Ks=(e,t)=>(X(e,t)&tt)===tt,Cc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Dn(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=Cc.reduce((n,o)=>(n[o]="function",n),t);return jt(e,r),e}function Dc(e,t,r){if(r<lt)throw new Error("invalid exponent, negatives unsupported");if(r===lt)return e.ONE;if(r===tt)return t;let n=e.ONE,o=t;for(;r>lt;)r&tt&&(n=e.mul(n,o)),o=e.sqr(o),r>>=tt;return n}function Fe(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),s),n}function Bs(e,t){let r=(e.ORDER-tt)/re,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Tc(e,t){t!==void 0&&Bt(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var _n=class{ORDER;BITS;BYTES;isLE;ZERO=lt;ONE=tt;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=lt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=Tc(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return X(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return lt<=t&&t<this.ORDER}is0(t){return t===lt}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&tt)===tt}neg(t){return X(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return X(t*t,this.ORDER)}add(t,r){return X(t+r,this.ORDER)}sub(t,r){return X(t-r,this.ORDER)}mul(t,r){return X(t*r,this.ORDER)}pow(t,r){return Dc(this,t,r)}div(t,r){return X(t*vs(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return vs(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=_c(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Bn(t,this.BYTES):hr(t,this.BYTES)}fromBytes(t,r=!1){U(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:c}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let f=new Uint8Array(o);f.set(t,s?0:f.length-t.length),t=f}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let a=s?ee(t):xe(t);if(c&&(a=X(a,i)),!r&&!this.isValid(a))throw new Error("invalid field element: outside of range 0..ORDER");return a}invertBatch(t){return Fe(this,t)}cmov(t,r,n){return n?r:t}};function Ee(e,t={}){return new _n(e,t)}function Os(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Tn(e){let t=Os(e);return t+Math.ceil(t/2)}function Ln(e,t,r=!1){U(e);let n=e.length,o=Os(t),s=Tn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?ee(e):xe(e),c=X(i,t-tt)+tt;return r?Bn(c,o):hr(c,o)}var Se=BigInt(0),ne=BigInt(1);function Ge(e,t){let r=t.negate();return e?r:t}function oe(e,t){let r=Fe(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function ks(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Rn(e,t){ks(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Ze(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Ps(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(e&o),a=e>>i;c>n&&(c-=s,a+=ne);let f=t*n,d=f+Math.abs(c)-1,u=c===0,w=c<0,S=t%2!==0;return{nextN:a,offset:d,isZero:u,isNeg:w,isNegF:S,offsetF:f}}var Kn=new WeakMap,Ms=new WeakMap;function On(e){return Ms.get(e)||1}function Us(e){if(e!==Se)throw new Error("invalid wNAF")}var Ae=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>Se;)r&ne&&(n=n.add(o)),o=o.double(),r>>=ne;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=Rn(r,this.bits),s=[],i=t,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let f=1;f<o;f++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=Rn(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:f,isZero:d,isNeg:u,isNegF:w,offsetF:S}=Ps(n,c,i);n=a,d?s=s.add(Ge(w,r[S])):o=o.add(Ge(u,r[f]))}return Us(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=Rn(t,this.bits);for(let i=0;i<s.windows&&n!==Se;i++){let{nextN:c,offset:a,isZero:f,isNeg:d}=Ps(n,i,s);if(n=c,!f){let u=r[a];o=o.add(d?u.negate():u)}}return Us(n),o}getPrecomputes(t,r,n){let o=Kn.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),Kn.set(r,o))),o}cached(t,r,n){let o=On(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=On(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){ks(r,this.bits),Ms.set(t,r),Kn.delete(t)}hasCache(t){return On(t)!==1}};function Vs(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Se||n>Se;)r&ne&&(s=s.add(o)),n&ne&&(i=i.add(o)),o=o.double(),r>>=ne,n>>=ne;return{p1:s,p2:i}}function Ns(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Dn(t),t}else return Ee(e,{isLE:r})}function mr(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let f=t[a];if(!(typeof f=="bigint"&&f>Se))throw new Error(`CURVE.${a} must be positive bigint`)}let o=Ns(t.p,r.Fp,n),s=Ns(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function yr(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var Yt=BigInt(0),et=BigInt(1),Pn=BigInt(2),Lc=BigInt(8);function Rc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function qs(e,t={}){let r=mr("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;jt(t,{},{uvRatio:"function"});let c=Pn<<BigInt(o.BYTES*8)-et,a=A=>n.create(A),f=t.uvRatio||((A,y)=>{try{return{isValid:!0,value:n.sqrt(n.div(A,y))}}catch{return{isValid:!1,value:Yt}}});if(!Rc(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function d(A,y,v=!1){let b=v?et:Yt;return ze("coordinate "+A,y,b,c),y}function u(A){if(!(A instanceof m))throw new Error("EdwardsPoint expected")}let w=we((A,y)=>{let{X:v,Y:b,Z:I}=A,K=A.is0();y==null&&(y=K?Lc:n.inv(I));let N=a(v*y),k=a(b*y),x=n.mul(I,y);if(K)return{x:Yt,y:et};if(x!==et)throw new Error("invZ was invalid");return{x:N,y:k}}),S=we(A=>{let{a:y,d:v}=s;if(A.is0())throw new Error("bad point: ZERO");let{X:b,Y:I,Z:K,T:N}=A,k=a(b*b),x=a(I*I),g=a(K*K),O=a(g*g),M=a(k*y),T=a(g*a(M+x)),h=a(O+a(v*a(k*x)));if(T!==h)throw new Error("bad point: equation left != right (1)");let p=a(b*I),l=a(K*N);if(p!==l)throw new Error("bad point: equation left != right (2)");return!0});class m{static BASE=new m(s.Gx,s.Gy,et,a(s.Gx*s.Gy));static ZERO=new m(Yt,et,et,Yt);static Fp=n;static Fn=o;X;Y;Z;T;constructor(y,v,b,I){this.X=d("x",y),this.Y=d("y",v),this.Z=d("z",b,!0),this.T=d("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){if(y instanceof m)throw new Error("extended point not allowed");let{x:v,y:b}=y||{};return d("x",v),d("y",b),new m(v,b,et,a(v*b))}static fromBytes(y,v=!1){let b=n.BYTES,{a:I,d:K}=s;y=pr(U(y,b,"point")),Ut(v,"zip215");let N=pr(y),k=y[b-1];N[b-1]=k&-129;let x=ee(N),g=v?c:n.ORDER;ze("point.y",x,Yt,g);let O=a(x*x),M=a(O-et),T=a(K*O-I),{isValid:h,value:p}=f(M,T);if(!h)throw new Error("bad point: invalid y coordinate");let l=(p&et)===et,E=(k&128)!==0;if(!v&&p===Yt&&E)throw new Error("bad point: x=0 and x_0=1");return E!==l&&(p=a(-p)),m.fromAffine({x:p,y:x})}static fromHex(y,v=!1){return m.fromBytes(Ot(y),v)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,v=!0){return B.createCache(this,y),v||this.multiply(Pn),this}assertValidity(){S(this)}equals(y){u(y);let{X:v,Y:b,Z:I}=this,{X:K,Y:N,Z:k}=y,x=a(v*k),g=a(K*I),O=a(b*k),M=a(N*I);return x===g&&O===M}is0(){return this.equals(m.ZERO)}negate(){return new m(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:y}=s,{X:v,Y:b,Z:I}=this,K=a(v*v),N=a(b*b),k=a(Pn*a(I*I)),x=a(y*K),g=v+b,O=a(a(g*g)-K-N),M=x+N,T=M-k,h=x-N,p=a(O*T),l=a(M*h),E=a(O*h),_=a(T*M);return new m(p,l,_,E)}add(y){u(y);let{a:v,d:b}=s,{X:I,Y:K,Z:N,T:k}=this,{X:x,Y:g,Z:O,T:M}=y,T=a(I*x),h=a(K*g),p=a(k*b*M),l=a(N*O),E=a((I+K)*(x+g)-T-h),_=l-p,D=l+p,L=a(h-v*T),C=a(E*_),R=a(D*L),P=a(E*L),G=a(_*D);return new m(C,R,G,P)}subtract(y){return this.add(y.negate())}multiply(y){if(!o.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:v,f:b}=B.cached(this,y,I=>oe(m,I));return oe(m,[v,b])[0]}multiplyUnsafe(y,v=m.ZERO){if(!o.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===Yt?m.ZERO:this.is0()||y===et?this:B.unsafe(this,y,b=>oe(m,b),v)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return B.unsafe(this,s.n).is0()}toAffine(y){return w(this,y)}clearCofactor(){return i===et?this:this.multiplyUnsafe(i)}toBytes(){let{x:y,y:v}=this.toAffine(),b=n.toBytes(v);return b[b.length-1]|=y&et?128:0,b}toHex(){return Kt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let B=new Ae(m,o.BITS);return m.BASE.precompute(8),m}function Hs(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');jt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,c=r.randomBytes||be,a=r.adjustScalarBytes||(x=>x),f=r.domain||((x,g,O)=>{if(Ut(O,"phflag"),g.length||O)throw new Error("Contexts/pre-hash are not supported");return x});function d(x){return i.create(ee(x))}function u(x){let g=b.secretKey;U(x,b.secretKey,"secretKey");let O=U(t(x),2*g,"hashedSecretKey"),M=a(O.slice(0,g)),T=O.slice(g,2*g),h=d(M);return{head:M,prefix:T,scalar:h}}function w(x){let{head:g,prefix:O,scalar:M}=u(x),T=o.multiply(M),h=T.toBytes();return{head:g,prefix:O,scalar:M,point:T,pointBytes:h}}function S(x){return w(x).pointBytes}function m(x=Uint8Array.of(),...g){let O=pt(...g);return d(t(f(O,U(x,void 0,"context"),!!n)))}function B(x,g,O={}){x=U(x,void 0,"message"),n&&(x=n(x));let{prefix:M,scalar:T,pointBytes:h}=w(g),p=m(O.context,M,x),l=o.multiply(p).toBytes(),E=m(O.context,l,h,x),_=i.create(p+E*T);if(!i.isValid(_))throw new Error("sign failed: invalid s");let D=pt(l,i.toBytes(_));return U(D,b.signature,"result")}let A={zip215:!0};function y(x,g,O,M=A){let{context:T,zip215:h}=M,p=b.signature;x=U(x,p,"signature"),g=U(g,void 0,"message"),O=U(O,b.publicKey,"publicKey"),h!==void 0&&Ut(h,"zip215"),n&&(g=n(g));let l=p/2,E=x.subarray(0,l),_=ee(x.subarray(l,p)),D,L,C;try{D=e.fromBytes(O,h),L=e.fromBytes(E,h),C=o.multiplyUnsafe(_)}catch{return!1}if(!h&&D.isSmallOrder())return!1;let R=m(T,L.toBytes(),D.toBytes(),g);return L.add(D.multiplyUnsafe(R)).subtract(C).clearCofactor().is0()}let v=s.BYTES,b={secretKey:v,publicKey:v,signature:2*v,seed:v};function I(x=c(b.seed)){return U(x,b.seed,"seed")}function K(x){return Jt(x)&&x.length===i.BYTES}function N(x,g){try{return!!e.fromBytes(x,g)}catch{return!1}}let k={getExtendedPublicKey:w,randomSecretKey:I,isValidSecretKey:K,isValidPublicKey:N,toMontgomery(x){let{y:g}=e.fromBytes(x),O=b.publicKey,M=O===32;if(!M&&O!==57)throw new Error("only defined for 25519 and 448");let T=M?s.div(et+g,et-g):s.div(g-et,g+et);return s.toBytes(T)},toMontgomerySecret(x){let g=b.secretKey;U(x,g);let O=t(x.subarray(0,g));return a(O).subarray(0,g)}};return Object.freeze({keygen:yr(I,S),getPublicKey:S,sign:B,verify:y,utils:k,Point:e,lengths:b})}var Kc=BigInt(1),zs=BigInt(2);var Oc=BigInt(5),Pc=BigInt(8),Un=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Uc={p:Un,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Pc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Nc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=Un,c=e*e%s*e%s,a=Z(c,zs,s)*c%s,f=Z(a,Kc,s)*e%s,d=Z(f,Oc,s)*f%s,u=Z(d,t,s)*d%s,w=Z(u,r,s)*u%s,S=Z(w,n,s)*w%s,m=Z(S,o,s)*S%s,B=Z(m,o,s)*S%s,A=Z(B,t,s)*d%s;return{pow_p_5_8:Z(A,zs,s)*e%s,b2:c}}function kc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Zs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Mc(e,t){let r=Un,n=X(t*t*t,r),o=X(n*n*t,r),s=Nc(e*o).pow_p_5_8,i=X(e*n*s,r),c=X(t*i*i,r),a=i,f=X(i*Zs,r),d=c===e,u=c===X(-e,r),w=c===X(-e*Zs,r);return d&&(i=a),(u||w)&&(i=f),Ks(i,r)&&(i=X(-i,r)),{isValid:d||u,value:i}}var Vc=qs(Uc,{uvRatio:Mc});function qc(e){return Hs(Vc,ws,Object.assign({adjustScalarBytes:kc},e))}var Fs=qc({});var $e=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},br=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Gs={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new br("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var gt=Gs;var gr=32;var Nn,Hc=(async()=>{try{return await gt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function zc(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await gt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await gt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function Zc(e,t,r){return Fs.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function $s(e,t,r){return Nn==null&&(Nn=await Hc),Nn?zc(e,t,r):Zc(e,t,r)}function xr(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var wr=class{type="Ed25519";raw;constructor(t){this.raw=kn(t,gr)}toMultihash(){return vt.digest(Zt(this))}toCID(){return Q.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=$s(this.raw,r,t);return xr(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function Ys(e){return e=kn(e,gr),new wr(e)}function kn(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new J(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Gc=Math.pow(2,7),$c=Math.pow(2,14),jc=Math.pow(2,21),Mn=Math.pow(2,28),Vn=Math.pow(2,35),qn=Math.pow(2,42),Hn=Math.pow(2,49),F=128,ft=127;function _t(e){if(e<Gc)return 1;if(e<$c)return 2;if(e<jc)return 3;if(e<Mn)return 4;if(e<Vn)return 5;if(e<qn)return 6;if(e<Hn)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function je(e,t,r=0){switch(_t(e)){case 8:t[r++]=e&255|F,e/=128;case 7:t[r++]=e&255|F,e/=128;case 6:t[r++]=e&255|F,e/=128;case 5:t[r++]=e&255|F,e/=128;case 4:t[r++]=e&255|F,e>>>=7;case 3:t[r++]=e&255|F,e>>>=7;case 2:t[r++]=e&255|F,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function zn(e,t){let r=e[t],n=0;if(n+=r&ft,r<F||(r=e[t+1],n+=(r&ft)<<7,r<F)||(r=e[t+2],n+=(r&ft)<<14,r<F)||(r=e[t+3],n+=(r&ft)<<21,r<F)||(r=e[t+4],n+=(r&ft)*Mn,r<F)||(r=e[t+5],n+=(r&ft)*Vn,r<F)||(r=e[t+6],n+=(r&ft)*qn,r<F)||(r=e[t+7],n+=(r&ft)*Hn,r<F))return n;throw new RangeError("Could not decode varint")}function Yc(e,t){let r=e.get(t),n=0;if(n+=r&ft,r<F||(r=e.get(t+1),n+=(r&ft)<<7,r<F)||(r=e.get(t+2),n+=(r&ft)<<14,r<F)||(r=e.get(t+3),n+=(r&ft)<<21,r<F)||(r=e.get(t+4),n+=(r&ft)*Mn,r<F)||(r=e.get(t+5),n+=(r&ft)*Vn,r<F)||(r=e.get(t+6),n+=(r&ft)*qn,r<F)||(r=e.get(t+7),n+=(r&ft)*Hn,r<F))return n;throw new RangeError("Could not decode varint")}function Zn(e,t=0){return e instanceof Uint8Array?zn(e,t):Yc(e,t)}var Fn=new Float32Array([-0]),Wt=new Uint8Array(Fn.buffer);function Ws(e,t,r){Fn[0]=e,t[r]=Wt[0],t[r+1]=Wt[1],t[r+2]=Wt[2],t[r+3]=Wt[3]}function Xs(e,t){return Wt[0]=e[t],Wt[1]=e[t+1],Wt[2]=e[t+2],Wt[3]=e[t+3],Fn[0]}var Gn=new Float64Array([-0]),ut=new Uint8Array(Gn.buffer);function Js(e,t,r){Gn[0]=e,t[r]=ut[0],t[r+1]=ut[1],t[r+2]=ut[2],t[r+3]=ut[3],t[r+4]=ut[4],t[r+5]=ut[5],t[r+6]=ut[6],t[r+7]=ut[7]}function Qs(e,t){return ut[0]=e[t],ut[1]=e[t+1],ut[2]=e[t+2],ut[3]=e[t+3],ut[4]=e[t+4],ut[5]=e[t+5],ut[6]=e[t+6],ut[7]=e[t+7],Gn[0]}var Xc=BigInt(Number.MAX_SAFE_INTEGER),Jc=BigInt(Number.MIN_SAFE_INTEGER),bt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return se;if(t<Xc&&t>Jc)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>ti&&(o=0n,++n>ti&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return se;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):se}},se=new bt(0,0);se.toBigInt=function(){return 0n};se.zzEncode=se.zzDecode=function(){return this};se.length=function(){return 1};var ti=4294967296n;function ei(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function ri(e,t,r){if(r-t<1)return"";let o,s=[],i=0,c;for(;t<r;)c=e[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function $n(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Et(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function Er(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var jn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Et(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Et(this,4);return Er(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Et(this,4);return Er(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Et(this,4);let t=Xs(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Et(this,4);let t=Qs(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Et(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return ri(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Et(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Et(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new bt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Et(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Et(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Et(this,8);let t=Er(this.buf,this.pos+=4),r=Er(this.buf,this.pos+=4);return new bt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=zn(this.buf,this.pos);return this.pos+=_t(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Yn(e){return new jn(e instanceof Uint8Array?e:e.subarray())}function ve(e,t,r){let n=Yn(e);return t.decode(n,void 0,r)}function Wn(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return mt(i);o+i>t&&(n=mt(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var ie=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function Xn(){}var Qn=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},Qc=Wn();function tf(e){return globalThis.Buffer!=null?mt(e):Qc(e)}var We=class{len;head;tail;states;constructor(){this.len=0,this.head=new ie(Xn,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new ie(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new to((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Sr,10,bt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=bt.fromBigInt(t);return this._push(Sr,r.length(),r)}uint64Number(t){return this._push(je,_t(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=bt.fromBigInt(t).zzEncode();return this._push(Sr,r.length(),r)}sint64Number(t){let r=bt.fromNumber(t).zzEncode();return this._push(Sr,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(Jn,1,t?1:0)}fixed32(t){return this._push(Ye,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=bt.fromBigInt(t);return this._push(Ye,4,r.lo)._push(Ye,4,r.hi)}fixed64Number(t){let r=bt.fromNumber(t);return this._push(Ye,4,r.lo)._push(Ye,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Ws,4,t)}double(t){return this._push(Js,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(Jn,1,0):this.uint32(r)._push(rf,r,t)}string(t){let r=ei(t);return r!==0?this.uint32(r)._push($n,r,t):this._push(Jn,1,0)}fork(){return this.states=new Qn(this),this.head=this.tail=new ie(Xn,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ie(Xn,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=tf(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function Jn(e,t,r){t[r]=e&255}function ef(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var to=class extends ie{next;constructor(t,r){super(ef,t,r),this.next=void 0}};function Sr(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Ye(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function rf(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(We.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(nf,t,e),this},We.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(of,t,e),this});function nf(e,t,r){t.set(e,r)}function of(e,t,r){e.length<40?$n(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(H(e),r)}function eo(){return new We}function Be(e,t){let r=eo();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Ie;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Ie||(Ie={}));function Ar(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function ro(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return Ar("enum",Ie.VARINT,r,n)}function _e(e,t){return Ar("message",Ie.LENGTH_DELIMITED,e,t)}var vr=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var rt;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(rt||(rt={}));var no;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(no||(no={}));(function(e){e.codec=()=>ro(no)})(rt||(rt={}));var Nt;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),rt.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=rt.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Be(r,e.codec()),e.decode=(r,n)=>ve(r,e.codec(),n)})(Nt||(Nt={}));var oo;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),rt.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=rt.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Be(r,e.codec()),e.decode=(r,n)=>ve(r,e.codec(),n)})(oo||(oo={}));var Je={};dt(Je,{MAX_RSA_KEY_SIZE:()=>so,generateRSAKeyPair:()=>ci,jwkToJWKKeyPair:()=>fi,jwkToPkcs1:()=>ff,jwkToPkix:()=>fo,jwkToRSAPrivateKey:()=>po,pkcs1MessageToJwk:()=>ao,pkcs1MessageToRSAPrivateKey:()=>uo,pkcs1ToJwk:()=>cf,pkcs1ToRSAPrivateKey:()=>ai,pkixMessageToJwk:()=>co,pkixMessageToRSAPublicKey:()=>ho,pkixToJwk:()=>uf,pkixToRSAPublicKey:()=>lo});var Ce=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=Je.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Q.createV1(114,this._multihash)}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return ii(this.jwk,r,t,n)}},Xe=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=Je.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}sign(t,r){return si(this.jwk,t,r)}};var so=8192,io=18,sf=1062,af=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function cf(e){let t=Tt(e);return ao(t)}function ao(e){return{n:q(e[1],"base64url"),e:q(e[2],"base64url"),d:q(e[3],"base64url"),p:q(e[4],"base64url"),q:q(e[5],"base64url"),dp:q(e[6],"base64url"),dq:q(e[7],"base64url"),qi:q(e[8],"base64url"),kty:"RSA"}}function ff(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new J("JWK was missing components");return zt([ht(Uint8Array.from([0])),ht(H(e.n,"base64url")),ht(H(e.e,"base64url")),ht(H(e.d,"base64url")),ht(H(e.p,"base64url")),ht(H(e.q,"base64url")),ht(H(e.dp,"base64url")),ht(H(e.dq,"base64url")),ht(H(e.qi,"base64url"))]).subarray()}function uf(e){let t=Tt(e,{offset:0});return co(t)}function co(e){let t=Tt(e[1],{offset:0});return{kty:"RSA",n:q(t[0],"base64url"),e:q(t[1],"base64url")}}function fo(e){if(e.n==null||e.e==null)throw new J("JWK was missing components");return zt([af,cr(zt([ht(H(e.n,"base64url")),ht(H(e.e,"base64url"))]))]).subarray()}function ai(e){let t=Tt(e);return uo(t)}function uo(e){let t=ao(e);return po(t)}function lo(e,t){if(e.byteLength>=sf)throw new ce("Key size is too large");let r=Tt(e,{offset:0});return ho(r,e,t)}function ho(e,t,r){let n=co(e);if(r==null){let o=ge(Nt.encode({Type:rt.RSA,Data:t}));r=At(io,o)}return new Ce(n,r)}function po(e){if(li(e)>so)throw new J("Key size is too large");let t=fi(e),r=ge(Nt.encode({Type:rt.RSA,Data:fo(t.publicKey)})),n=At(io,r);return new Xe(t.privateKey,new Ce(t.publicKey,n))}async function ci(e){if(e>so)throw new J("Key size is too large");let t=await ui(e),r=ge(Nt.encode({Type:rt.RSA,Data:fo(t.publicKey)})),n=At(io,r);return new Xe(t.privateKey,new Ce(t.publicKey,n))}function fi(e){if(e==null)throw new J("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function ui(e,t){let r=await gt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await lf(r,t);return{privateKey:n[0],publicKey:n[1]}}async function si(e,t,r){let n=await gt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await gt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function ii(e,t,r,n){let o=await gt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await gt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function lf(e,t){if(e.privateKey==null||e.publicKey==null)throw new J("Private and public key are required");let r=await Promise.all([gt.get().subtle.exportKey("jwk",e.privateKey),gt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function li(e){if(e.kty!=="RSA")throw new J("invalid key type");if(e.n==null)throw new J("invalid key modulus");return H(e.n,"base64url").length*8}var Br=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(fr(t),U(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),Rt(o)}update(t){return ye(this),this.iHash.update(t),this}digestInto(t){ye(this),U(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},mo=(e,t,r)=>new Br(e,t).update(r).digest();mo.create=(e,t)=>new Br(e,t);var di=(e,t)=>(e+(e>=0?t:-t)/hi)/t;function df(e,t,r){let[[n,o],[s,i]]=t,c=di(i*e,r),a=di(-o*e,r),f=e-c*n-a*s,d=-c*o-a*i,u=f<kt,w=d<kt;u&&(f=-f),w&&(d=-d);let S=Ze(Math.ceil(In(r)/2))+De;if(f<kt||f>=S||d<kt||d>=S)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:f,k2neg:w,k2:d}}function bo(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function yo(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return Ut(r.lowS,"lowS"),Ut(r.prehash,"prehash"),r.format!==void 0&&bo(r.format),r}var go=class extends Error{constructor(t=""){super(t)}},Xt={Err:go,_tlv:{encode:(e,t)=>{let{Err:r}=Xt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=He(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?He(o.length/2|128):"";return He(e)+s+o+t},decode(e,t){let{Err:r}=Xt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+a);if(f.length!==a)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let d of f)i=i<<8|d;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Xt;if(e<kt)throw new t("integer: negative integers are not allowed");let r=He(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Xt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return xe(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Xt,o=U(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:f,l:d}=n.decode(2,a);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(f)}},hexFromSig(e){let{_tlv:t,_int:r}=Xt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},kt=BigInt(0),De=BigInt(1),hi=BigInt(2),Ir=BigInt(3),hf=BigInt(4);function pi(e,t={}){let r=mr("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;jt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:a}=t;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let f=yi(n,o);function d(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function u(T,h,p){let{x:l,y:E}=h.toAffine(),_=n.toBytes(l);if(Ut(p,"isCompressed"),p){d();let D=!n.isOdd(E);return pt(mi(D),_)}else return pt(Uint8Array.of(4),_,n.toBytes(E))}function w(T){U(T,void 0,"Point");let{publicKey:h,publicKeyUncompressed:p}=f,l=T.length,E=T[0],_=T.subarray(1);if(l===h&&(E===2||E===3)){let D=n.fromBytes(_);if(!n.isValid(D))throw new Error("bad point: is not on curve, wrong x");let L=B(D),C;try{C=n.sqrt(L)}catch(G){let z=G instanceof Error?": "+G.message:"";throw new Error("bad point: is not on curve, sqrt error"+z)}d();let R=n.isOdd(C);return(E&1)===1!==R&&(C=n.neg(C)),{x:D,y:C}}else if(l===p&&E===4){let D=n.BYTES,L=n.fromBytes(_.subarray(0,D)),C=n.fromBytes(_.subarray(D,D*2));if(!A(L,C))throw new Error("bad point: is not on curve");return{x:L,y:C}}else throw new Error(`bad point: got length ${l}, expected compressed=${h} or uncompressed=${p}`)}let S=t.toBytes||u,m=t.fromBytes||w;function B(T){let h=n.sqr(T),p=n.mul(h,T);return n.add(n.add(p,n.mul(T,s.a)),s.b)}function A(T,h){let p=n.sqr(h),l=B(T);return n.eql(p,l)}if(!A(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=n.mul(n.pow(s.a,Ir),hf),v=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(y,v)))throw new Error("bad curve params: a or b");function b(T,h,p=!1){if(!n.isValid(h)||p&&n.is0(h))throw new Error(`bad point coordinate ${T}`);return h}function I(T){if(!(T instanceof g))throw new Error("Weierstrass Point expected")}function K(T){if(!a||!a.basises)throw new Error("no endo");return df(T,a.basises,o.ORDER)}let N=we((T,h)=>{let{X:p,Y:l,Z:E}=T;if(n.eql(E,n.ONE))return{x:p,y:l};let _=T.is0();h==null&&(h=_?n.ONE:n.inv(E));let D=n.mul(p,h),L=n.mul(l,h),C=n.mul(E,h);if(_)return{x:n.ZERO,y:n.ZERO};if(!n.eql(C,n.ONE))throw new Error("invZ was invalid");return{x:D,y:L}}),k=we(T=>{if(T.is0()){if(t.allowInfinityPoint&&!n.is0(T.Y))return;throw new Error("bad point: ZERO")}let{x:h,y:p}=T.toAffine();if(!n.isValid(h)||!n.isValid(p))throw new Error("bad point: x or y not field elements");if(!A(h,p))throw new Error("bad point: equation left != right");if(!T.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function x(T,h,p,l,E){return p=new g(n.mul(p.X,T),p.Y,p.Z),h=Ge(l,h),p=Ge(E,p),h.add(p)}class g{static BASE=new g(s.Gx,s.Gy,n.ONE);static ZERO=new g(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(h,p,l){this.X=b("x",h),this.Y=b("y",p,!0),this.Z=b("z",l),Object.freeze(this)}static CURVE(){return s}static fromAffine(h){let{x:p,y:l}=h||{};if(!h||!n.isValid(p)||!n.isValid(l))throw new Error("invalid affine point");if(h instanceof g)throw new Error("projective point not allowed");return n.is0(p)&&n.is0(l)?g.ZERO:new g(p,l,n.ONE)}static fromBytes(h){let p=g.fromAffine(m(U(h,void 0,"point")));return p.assertValidity(),p}static fromHex(h){return g.fromBytes(Ot(h))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(h=8,p=!0){return M.createCache(this,h),p||this.multiply(Ir),this}assertValidity(){k(this)}hasEvenY(){let{y:h}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(h)}equals(h){I(h);let{X:p,Y:l,Z:E}=this,{X:_,Y:D,Z:L}=h,C=n.eql(n.mul(p,L),n.mul(_,E)),R=n.eql(n.mul(l,L),n.mul(D,E));return C&&R}negate(){return new g(this.X,n.neg(this.Y),this.Z)}double(){let{a:h,b:p}=s,l=n.mul(p,Ir),{X:E,Y:_,Z:D}=this,L=n.ZERO,C=n.ZERO,R=n.ZERO,P=n.mul(E,E),G=n.mul(_,_),z=n.mul(D,D),V=n.mul(E,_);return V=n.add(V,V),R=n.mul(E,D),R=n.add(R,R),L=n.mul(h,R),C=n.mul(l,z),C=n.add(L,C),L=n.sub(G,C),C=n.add(G,C),C=n.mul(L,C),L=n.mul(V,L),R=n.mul(l,R),z=n.mul(h,z),V=n.sub(P,z),V=n.mul(h,V),V=n.add(V,R),R=n.add(P,P),P=n.add(R,P),P=n.add(P,z),P=n.mul(P,V),C=n.add(C,P),z=n.mul(_,D),z=n.add(z,z),P=n.mul(z,V),L=n.sub(L,P),R=n.mul(z,G),R=n.add(R,R),R=n.add(R,R),new g(L,C,R)}add(h){I(h);let{X:p,Y:l,Z:E}=this,{X:_,Y:D,Z:L}=h,C=n.ZERO,R=n.ZERO,P=n.ZERO,G=s.a,z=n.mul(s.b,Ir),V=n.mul(p,_),$=n.mul(l,D),ot=n.mul(E,L),St=n.add(p,l),j=n.add(_,D);St=n.mul(St,j),j=n.add(V,$),St=n.sub(St,j),j=n.add(p,E);let at=n.add(_,L);return j=n.mul(j,at),at=n.add(V,ot),j=n.sub(j,at),at=n.add(l,E),C=n.add(D,L),at=n.mul(at,C),C=n.add($,ot),at=n.sub(at,C),P=n.mul(G,j),C=n.mul(z,ot),P=n.add(C,P),C=n.sub($,P),P=n.add($,P),R=n.mul(C,P),$=n.add(V,V),$=n.add($,V),ot=n.mul(G,ot),j=n.mul(z,j),$=n.add($,ot),ot=n.sub(V,ot),ot=n.mul(G,ot),j=n.add(j,ot),V=n.mul($,j),R=n.add(R,V),V=n.mul(at,j),C=n.mul(St,C),C=n.sub(C,V),V=n.mul(St,$),P=n.mul(at,P),P=n.add(P,V),new g(C,R,P)}subtract(h){return this.add(h.negate())}is0(){return this.equals(g.ZERO)}multiply(h){let{endo:p}=t;if(!o.isValidNot0(h))throw new Error("invalid scalar: out of range");let l,E,_=D=>M.cached(this,D,L=>oe(g,L));if(p){let{k1neg:D,k1:L,k2neg:C,k2:R}=K(h),{p:P,f:G}=_(L),{p:z,f:V}=_(R);E=G.add(V),l=x(p.beta,P,z,D,C)}else{let{p:D,f:L}=_(h);l=D,E=L}return oe(g,[l,E])[0]}multiplyUnsafe(h){let{endo:p}=t,l=this;if(!o.isValid(h))throw new Error("invalid scalar: out of range");if(h===kt||l.is0())return g.ZERO;if(h===De)return l;if(M.hasCache(this))return this.multiply(h);if(p){let{k1neg:E,k1:_,k2neg:D,k2:L}=K(h),{p1:C,p2:R}=Vs(g,l,_,L);return x(p.beta,C,R,E,D)}else return M.unsafe(l,h)}toAffine(h){return N(this,h)}isTorsionFree(){let{isTorsionFree:h}=t;return i===De?!0:h?h(g,this):M.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:h}=t;return i===De?this:h?h(g,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(h=!0){return Ut(h,"isCompressed"),this.assertValidity(),S(g,this,h)}toHex(h=!0){return Kt(this.toBytes(h))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let O=o.BITS,M=new Ae(g,t.endo?Math.ceil(O/2):O);return g.BASE.precompute(8),g}function mi(e){return Uint8Array.of(e?2:3)}function yi(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function pf(e,t={}){let{Fn:r}=e,n=t.randomBytes||be,o=Object.assign(yi(e.Fp,r),{seed:Tn(r.ORDER)});function s(S){try{let m=r.fromBytes(S);return r.isValidNot0(m)}catch{return!1}}function i(S,m){let{publicKey:B,publicKeyUncompressed:A}=o;try{let y=S.length;return m===!0&&y!==B||m===!1&&y!==A?!1:!!e.fromBytes(S)}catch{return!1}}function c(S=n(o.seed)){return Ln(U(S,o.seed,"seed"),r.ORDER)}function a(S,m=!0){return e.BASE.multiply(r.fromBytes(S)).toBytes(m)}function f(S){let{secretKey:m,publicKey:B,publicKeyUncompressed:A}=o;if(!Jt(S)||"_lengths"in r&&r._lengths||m===B)return;let y=U(S,void 0,"key").length;return y===B||y===A}function d(S,m,B=!0){if(f(S)===!0)throw new Error("first arg must be private key");if(f(m)===!1)throw new Error("second arg must be public key");let A=r.fromBytes(S);return e.fromBytes(m).multiply(A).toBytes(B)}let u={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c},w=yr(c,a);return Object.freeze({getPublicKey:a,getSharedSecret:d,keygen:w,Point:e,utils:u,lengths:o})}function bi(e,t,r={}){fr(t),jt(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||be,o=r.hmac||((p,l)=>mo(t,p,l)),{Fp:s,Fn:i}=e,{ORDER:c,BITS:a}=i,{keygen:f,getPublicKey:d,getSharedSecret:u,utils:w,lengths:S}=pf(e,r),m={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},B=c*hi<s.ORDER;function A(p){let l=c>>De;return p>l}function y(p,l){if(!i.isValidNot0(l))throw new Error(`invalid signature ${p}: out of range 1..Point.Fn.ORDER`);return l}function v(){if(B)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function b(p,l){bo(l);let E=S.signature,_=l==="compact"?E:l==="recovered"?E+1:void 0;return U(p,_)}class I{r;s;recovery;constructor(l,E,_){if(this.r=y("r",l),this.s=y("s",E),_!=null){if(v(),![0,1,2,3].includes(_))throw new Error("invalid recovery id");this.recovery=_}Object.freeze(this)}static fromBytes(l,E=m.format){b(l,E);let _;if(E==="der"){let{r:R,s:P}=Xt.toSig(U(l));return new I(R,P)}E==="recovered"&&(_=l[0],E="compact",l=l.subarray(1));let D=S.signature/2,L=l.subarray(0,D),C=l.subarray(D,D*2);return new I(i.fromBytes(L),i.fromBytes(C),_)}static fromHex(l,E){return this.fromBytes(Ot(l),E)}assertRecovery(){let{recovery:l}=this;if(l==null)throw new Error("invalid recovery id: must be present");return l}addRecoveryBit(l){return new I(this.r,this.s,l)}recoverPublicKey(l){let{r:E,s:_}=this,D=this.assertRecovery(),L=D===2||D===3?E+c:E;if(!s.isValid(L))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let C=s.toBytes(L),R=e.fromBytes(pt(mi((D&1)===0),C)),P=i.inv(L),G=N(U(l,void 0,"msgHash")),z=i.create(-G*P),V=i.create(_*P),$=e.BASE.multiplyUnsafe(z).add(R.multiplyUnsafe(V));if($.is0())throw new Error("invalid recovery: point at infinify");return $.assertValidity(),$}hasHighS(){return A(this.s)}toBytes(l=m.format){if(bo(l),l==="der")return Ot(Xt.hexFromSig(this));let{r:E,s:_}=this,D=i.toBytes(E),L=i.toBytes(_);return l==="recovered"?(v(),pt(Uint8Array.of(this.assertRecovery()),D,L)):pt(D,L)}toHex(l){return Kt(this.toBytes(l))}}let K=r.bits2int||function(l){if(l.length>8192)throw new Error("input is too large");let E=xe(l),_=l.length*8-a;return _>0?E>>BigInt(_):E},N=r.bits2int_modN||function(l){return i.create(K(l))},k=Ze(a);function x(p){return ze("num < 2^"+a,p,kt,k),i.toBytes(p)}function g(p,l){return U(p,void 0,"message"),l?U(t(p),void 0,"prehashed message"):p}function O(p,l,E){let{lowS:_,prehash:D,extraEntropy:L}=yo(E,m);p=g(p,D);let C=N(p),R=i.fromBytes(l);if(!i.isValidNot0(R))throw new Error("invalid private key");let P=[x(R),x(C)];if(L!=null&&L!==!1){let $=L===!0?n(S.secretKey):L;P.push(U($,void 0,"extraEntropy"))}let G=pt(...P),z=C;function V($){let ot=K($);if(!i.isValidNot0(ot))return;let St=i.inv(ot),j=e.BASE.multiply(ot).toAffine(),at=i.create(j.x);if(at===kt)return;let rr=i.create(St*i.create(z+at*R));if(rr===kt)return;let Do=(j.x===at?0:2)|Number(j.y&De),To=rr;return _&&A(rr)&&(To=i.neg(rr),Do^=1),new I(at,To,B?void 0:Do)}return{seed:G,k2sig:V}}function M(p,l,E={}){let{seed:_,k2sig:D}=O(p,l,E);return As(t.outputLen,i.BYTES,o)(_,D).toBytes(E.format)}function T(p,l,E,_={}){let{lowS:D,prehash:L,format:C}=yo(_,m);if(E=U(E,void 0,"publicKey"),l=g(l,L),!Jt(p)){let R=p instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+R)}b(p,C);try{let R=I.fromBytes(p,C),P=e.fromBytes(E);if(D&&R.hasHighS())return!1;let{r:G,s:z}=R,V=N(l),$=i.inv(z),ot=i.create(V*$),St=i.create(G*$),j=e.BASE.multiplyUnsafe(ot).add(P.multiplyUnsafe(St));return j.is0()?!1:i.create(j.x)===G}catch{return!1}}function h(p,l,E={}){let{prehash:_}=yo(E,m);return l=g(l,_),I.fromBytes(p,"recovered").recoverPublicKey(l).toBytes()}return Object.freeze({keygen:f,getPublicKey:d,getSharedSecret:u,utils:w,lengths:S,Point:e,sign:M,verify:T,recoverPublicKey:h,Signature:I,hash:t})}var wo={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},mf={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var gi=BigInt(2);function yf(e){let t=wo.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,d=f*f*e%t,u=Z(d,r,t)*d%t,w=Z(u,r,t)*d%t,S=Z(w,gi,t)*f%t,m=Z(S,o,t)*S%t,B=Z(m,s,t)*m%t,A=Z(B,c,t)*B%t,y=Z(A,a,t)*A%t,v=Z(y,c,t)*B%t,b=Z(v,r,t)*d%t,I=Z(b,i,t)*m%t,K=Z(I,n,t)*f%t,N=Z(K,gi,t);if(!xo.eql(xo.sqr(N),e))throw new Error("Cannot find square root");return N}var xo=Ee(wo.p,{sqrt:yf}),bf=pi(wo,{Fp:xo,endo:mf}),Te=bi(bf,ge);function xi(e,t,r,n){let o=ir.digest(r instanceof Uint8Array?r:r.subarray());if(xr(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Te.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new $e(String(s))});try{return n?.signal?.throwIfAborted(),Te.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new $e(String(s))}}var _r=class{type="secp256k1";raw;_key;constructor(t){this._key=Ei(t),this.raw=wi(this._key)}toMultihash(){return vt.digest(Zt(this))}toCID(){return Q.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return xi(this._key,r,t,n)}};function Si(e){return new _r(e)}function wi(e){return Te.Point.fromBytes(e).toBytes()}function Ei(e){try{return Te.Point.fromBytes(e),e}catch(t){throw new ce(String(t))}}function Ai(e,t){let{Type:r,Data:n}=Nt.decode(e),o=n??new Uint8Array;switch(r){case rt.RSA:return lo(o,t);case rt.Ed25519:return Ys(o);case rt.secp256k1:return Si(o);case rt.ECDSA:return ns(o);default:throw new fe}}function Zt(e){return Nt.encode({Type:rt[e.type],Data:e.raw})}var vi=Symbol.for("nodejs.util.inspect.custom"),gf=114,Qe=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Mr]=!0;toString(){return this.string==null&&(this.string=W.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Q.createV1(gf,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ct(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ct(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[vi](){return`PeerId(${this.toString()})`}},Cr=class extends Qe{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Dr=class extends Qe{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Tr=class extends Qe{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},xf=2336,Eo=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=vt.digest(H(this.url))}[vi](){return`PeerId(${this.url})`}[Mr]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Q.createV1(xf,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=q(t)),t.toString()===this.toString())}};function Bi(e){if(e.type==="Ed25519")return new Dr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new Tr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Cr({multihash:e.toCID().multihash,publicKey:e});throw new fe}var it=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},Mt=class extends Error{static name="ValidationError";name="ValidationError"},Lr=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Rr=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var Kr=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,c=this.peekChar();if(c===void 0)return;let a=c==="0",f=2**(8*o)-1;for(;;){let d=this.readAtomically(()=>{let u=this.readChar();if(u===void 0)return;let w=Number.parseInt(u,t);if(!Number.isNaN(w))return w});if(d===void 0)break;if(s*=t,s+=d,s>f||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&a&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[c]=t(s.subarray(0,i));return r.set(s.subarray(0,c),16-c),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var wf=45,Ef=15,Or=new Kr;function Ii(e){if(!(e.length>Ef))return Or.new(e).parseWith(()=>Or.readIPv4Addr())}function _i(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>wf))return Or.new(e).parseWith(()=>Or.readIPv6Addr())}function Pr(e){return!!Ii(e)}function Ci(e){return!!_i(e)}function Ao(e){return t=>q(t,e)}function vo(e){return t=>H(t,e)}function Le(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function ae(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function Di(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=H(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=ae(n);return Dt([r,o],r.length+o.length)}function Ti(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=Ht.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=ae(n);return Dt([r,o],r.length+o.length)}function Bo(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=q(t,"base32"),o=Le(r);return`${n}:${o}`}var Io=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new it("Invalid byte value in IP address");t[n]=o}),t},Li=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=Pr(r[n]),i;s&&(i=Io(r[n]),r[n]=q(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,q(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new it("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},Ri=function(e){if(e.byteLength!==4)throw new it("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},Ki=function(e){if(e.byteLength!==16)throw new it("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new it(`Invalid IPv6 address "${r}"`)}};function Oi(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new it(`Invalid IPv6 address "${e}"`)}}var So=Object.values(Ue).map(e=>e.decoder),Sf=(function(){let e=So[0].or(So[1]);return So.slice(2).forEach(t=>e=e.or(t)),e})();function Pi(e){return Sf.decode(e)}function Ui(e){return t=>e.encoder.encode(t)}function Af(e){if(parseInt(e).toString()!==e)throw new Mt("Value must be an integer")}function vf(e){if(e<0)throw new Mt("Value must be a positive integer, or zero")}function Bf(e){return t=>{if(t>e)throw new Mt(`Value must be smaller than or equal to ${e}`)}}function If(...e){return t=>{for(let r of e)r(t)}}var tr=If(Af,vf,Bf(65535));var nt=-1,_o=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new Rr(`Protocol ${t} was unknown`);return r}addProtocol(t){this.protocolsByCode.set(t.code,t),this.protocolsByName.set(t.name,t),t.aliases?.forEach(r=>{this.protocolsByName.set(r,t)})}removeProtocol(t){let r=this.protocolsByCode.get(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},Vt=new _o,hu=[{code:4,name:"ip4",size:32,valueToBytes:Io,bytesToValue:Ri,validate:e=>{if(!Pr(e))throw new Mt(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:ae,bytesToValue:Le,validate:tr},{code:273,name:"udp",size:16,valueToBytes:ae,bytesToValue:Le,validate:tr},{code:33,name:"dccp",size:16,valueToBytes:ae,bytesToValue:Le,validate:tr},{code:41,name:"ip6",size:128,valueToBytes:Li,bytesToValue:Ki,stringToValue:Oi,validate:e=>{if(!Ci(e))throw new Mt(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:nt},{code:43,name:"ipcidr",size:8,bytesToValue:Ao("base10"),valueToBytes:vo("base10")},{code:53,name:"dns",size:nt},{code:54,name:"dns4",size:nt},{code:55,name:"dns6",size:nt},{code:56,name:"dnsaddr",size:nt},{code:132,name:"sctp",size:16,valueToBytes:ae,bytesToValue:Le,validate:tr},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:nt,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:nt,bytesToValue:Ao("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?vo("base58btc")(e):Q.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Bo,valueToBytes:Di},{code:445,name:"onion3",size:296,bytesToValue:Bo,valueToBytes:Ti},{code:446,name:"garlic64",size:nt},{code:447,name:"garlic32",size:nt},{code:448,name:"tls"},{code:449,name:"sni",size:nt},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:nt,bytesToValue:Ui(en),valueToBytes:Pi},{code:480,name:"http"},{code:481,name:"http-path",size:nt,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:nt}];hu.forEach(e=>{Vt.addProtocol(e)});function Ni(e){let t=[],r=0;for(;r<e.length;){let n=Zn(e,r),o=Vt.getProtocol(n),s=_t(n),i=pu(o,e,r+s),c=0;i>0&&o.size===nt&&(c=_t(i));let a=s+c+i,f={code:n,name:o.name,bytes:e.subarray(r,r+a)};if(i>0){let d=r+s+c,u=e.subarray(d,d+i);f.value=o.bytesToValue?.(u)??q(u)}t.push(f),r+=a}return t}function ki(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=Vt.getProtocol(n.code),s=_t(n.code),i,c=0,a=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??H(n.value),c=i.byteLength,o.size===nt&&(a=_t(c)));let f=new Uint8Array(s+a+c),d=0;je(n.code,f,d),d+=s,i!=null&&(o.size===nt&&(je(c,f,d),d+=a),f.set(i,d)),n.bytes=f}r.push(n.bytes),t+=n.bytes.byteLength}return Dt(r,t)}function Mi(e){if(e.charAt(0)!=="/")throw new it('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let c=s===e.length-1;if(i==="/"||c){let a=Vt.getProtocol(o);if(r==="protocol"){if(a.size==null||a.size===0){t.push({code:a.code,name:a.name}),n="",o="",r="protocol";continue}else if(c)throw new it(`Component ${o} was missing value`);r="value"}else if(r==="value"){let f={code:a.code,name:a.name};if(a.size!=null&&a.size!==0){if(n==="")throw new it(`Component ${o} was missing value`);f.value=a.stringToValue?.(n)??n}t.push(f),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new it("Incomplete multiaddr");return t}function Vi(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=Vt.getProtocol(t.code);if(r==null)throw new it(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function pu(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:Zn(t,r)}var mu=Symbol.for("nodejs.util.inspect.custom"),Co=Symbol.for("@multiformats/multiaddr");function yu(e){if(e==null&&(e="/"),qi(e))return e.getComponents();if(e instanceof Uint8Array)return Ni(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),Mi(e);if(Array.isArray(e))return e;throw new it("Must be a string, Uint8Array, Component[], or another Multiaddr")}var Ur=class e{[Co]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=yu(t),r.validate!==!1&&bu(this)}get bytes(){return this.#r==null&&(this.#r=ki(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=Vi(this.#t)),this.#e}toJSON(){return this.toString()}getComponents(){return[...this.#t.map(t=>({...t}))]}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new Lr(`Address ${this.toString()} does not contain subaddress: ${r}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}equals(t){return ct(this.bytes,t.bytes)}[mu](){return`Multiaddr(${this.toString()})`}};function bu(e){e.getComponents().forEach(t=>{let r=Vt.getProtocol(t.code);t.value!=null&&r.validate?.(t.value)})}function qi(e){return!!e?.[Co]}function Hi(e){return new Ur(e)}var er;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.publicKey!=null&&r.publicKey.byteLength>0&&(n.uint32(10),n.bytes(r.publicKey)),r.addrs!=null)for(let s of r.addrs)n.uint32(18),n.bytes(s);o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={publicKey:xt(0),addrs:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.publicKey=r.bytes();break}case 2:{if(o.limits?.addrs!=null&&s.addrs.length===o.limits.addrs)throw new vr('Decode error - map field "addrs" had too many elements');s.addrs.push(r.bytes());break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Be(r,e.codec()),e.decode=(r,n)=>ve(r,e.codec(),n)})(er||(er={}));var zi="_peer-discovery._p2p._pubsub",Nr=class extends nr{[Lo]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(t,r={}){super();let{interval:n,topics:o,listenOnly:s}=r;this.components=t,this.interval=n??1e4,this.listenOnly=s??!1,this.log=t.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(o)&&o.length>0?this.topics=o:this.topics=[zi],this._onMessage=this._onMessage.bind(this)}isStarted(){return this.intervalId!=null}start(){}afterStart(){if(this.intervalId!=null)return;let t=this.components.pubsub;if(t==null)throw new Error("PubSub not configured");for(let r of this.topics)t.subscribe(r),t.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval(()=>{this._broadcast()},this.interval))}beforeStop(){let t=this.components.pubsub;if(t==null)throw new Error("PubSub not configured");for(let r of this.topics)t.unsubscribe(r),t.removeEventListener("message",this._onMessage)}stop(){this.intervalId!=null&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){let t=this.components.peerId;if(t.publicKey==null)throw new Error("PeerId was missing public key");let r={publicKey:Zt(t.publicKey),addrs:this.components.addressManager.getAddresses().map(s=>s.bytes)},n=er.encode(r),o=this.components.pubsub;if(o==null)throw new Error("PubSub not configured");for(let s of this.topics){if(o.getSubscribers(s).length===0){this.log("skipping broadcasting our peer data on topic %s because there are no peers present",s);continue}this.log("broadcasting our peer data on topic %s",s),o.publish(s,n)}}_onMessage(t){if(!this.isStarted())return;let r=t.detail;if(this.topics.includes(r.topic))try{let n=er.decode(r.data),o=Ai(n.publicKey),s=Bi(o);if(s.equals(this.components.peerId))return;this.log("discovered peer %p on %s",s,r.topic),this.safeDispatchEvent("peer",{detail:{id:s,multiaddrs:n.addrs.map(i=>Hi(i))}})}catch(n){this.log.error("error handling incoming message",n)}}};function gu(e={}){return t=>new Nr(t,e)}return ji(xu);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PPubsubPeerDiscovery}));
//# sourceMappingURL=index.min.js.map
