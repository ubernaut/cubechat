(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PIdentify = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PIdentify=(()=>{var nu=Object.create;var Yr=Object.defineProperty;var ou=Object.getOwnPropertyDescriptor;var su=Object.getOwnPropertyNames;var iu=Object.getPrototypeOf,au=Object.prototype.hasOwnProperty;var cu=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Et=(e,t)=>{for(var r in t)Yr(e,r,{get:t[r],enumerable:!0})},mi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of su(t))!au.call(e,o)&&o!==r&&Yr(e,o,{get:()=>t[o],enumerable:!(n=ou(t,o))||n.enumerable});return e};var uu=(e,t,r)=>(r=e!=null?nu(iu(e)):{},mi(t||!e||!e.__esModule?Yr(r,"default",{value:e,enumerable:!0}):r,e)),fu=e=>mi(Yr({},"__esModule",{value:!0}),e);var Oc=cu($r=>{(function(){var e,t,r,n,o,s,i,c;c=function(a){var u,f,l,h;return u=(a&255<<24)>>>24,f=(a&255<<16)>>>16,l=(a&65280)>>>8,h=a&255,[u,f,l,h].join(".")},i=function(a){var u,f,l,h,p,d;for(u=[],l=h=0;h<=3&&a.length!==0;l=++h){if(l>0){if(a[0]!==".")throw new Error("Invalid IP");a=a.substring(1)}d=t(a),p=d[0],f=d[1],a=a.substring(f),u.push(p)}if(a.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},r=function(a){return a.charCodeAt(0)},n=r("0"),s=r("a"),o=r("A"),t=function(a){var u,f,l,h,p;for(h=0,u=10,f="9",l=0,a.length>1&&a[l]==="0"&&(a[l+1]==="x"||a[l+1]==="X"?(l+=2,u=16):"0"<=a[l+1]&&a[l+1]<="9"&&(l++,u=8,f="7")),p=l;l<a.length;){if("0"<=a[l]&&a[l]<=f)h=h*u+(r(a[l])-n)>>>0;else if(u===16)if("a"<=a[l]&&a[l]<="f")h=h*u+(10+r(a[l])-s)>>>0;else if("A"<=a[l]&&a[l]<="F")h=h*u+(10+r(a[l])-o)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");l++}if(l===p)throw new Error("empty octet");return[h,l]},e=(function(){function a(u,f){var l,h,p,d;if(typeof u!="string")throw new Error("Missing `net' parameter");if(f||(d=u.split("/",2),u=d[0],f=d[1]),f||(f=32),typeof f=="string"&&f.indexOf(".")>-1){try{this.maskLong=i(f)}catch(E){throw l=E,new Error("Invalid mask: "+f)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(f||f===0)this.bitmask=parseInt(f,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(i(u)&this.maskLong)>>>0}catch(E){throw l=E,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+f);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return a.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new a(u)),u instanceof a?this.contains(u.base)&&this.contains(u.broadcast||u.last):(i(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},a.prototype.next=function(u){return u==null&&(u=1),new a(c(this.netLong+this.size*u),this.mask)},a.prototype.forEach=function(u){var f,l,h;for(h=i(this.first),l=i(this.last),f=0;h<=l;)u(c(h),h,f),f++,h++},a.prototype.toString=function(){return this.base+"/"+this.bitmask},a})(),$r.ip2long=i,$r.long2ip=c,$r.Netmask=e}).call($r)});var zd={};Et(zd,{identify:()=>qd,identifyPush:()=>Hd});var Q=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Oe=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Wr=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},jr=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}};var Tt=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}};var he=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var $n=Symbol.for("@libp2p/peer-id");var Xr=Symbol.for("@libp2p/service-capabilities"),Yd=Symbol.for("@libp2p/service-dependencies");var jn={};Et(jn,{base58btc:()=>nt,base58flickr:()=>bu});var wh=new Uint8Array(0);function yi(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function zt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function bi(e){return new TextEncoder().encode(e)}function gi(e){return new TextDecoder().decode(e)}function lu(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,a=e.charAt(0),u=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var E=0,S=0,g=0,A=d.length;g!==A&&d[g]===0;)g++,E++;for(var x=(A-g)*f+1>>>0,_=new Uint8Array(x);g!==A;){for(var R=d[g],k=0,M=x-1;(R!==0||k<S)&&M!==-1;M--,k++)R+=256*_[M]>>>0,_[M]=R%c>>>0,R=R/c>>>0;if(R!==0)throw new Error("Non-zero carry");S=k,g++}for(var v=x-S;v!==x&&_[v]===0;)v++;for(var w=a.repeat(E);v<x;++v)w+=e.charAt(_[v]);return w}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var E=0;if(d[E]!==" "){for(var S=0,g=0;d[E]===a;)S++,E++;for(var A=(d.length-E)*u+1>>>0,x=new Uint8Array(A);d[E];){var _=r[d.charCodeAt(E)];if(_===255)return;for(var R=0,k=A-1;(_!==0||R<g)&&k!==-1;k--,R++)_+=c*x[k]>>>0,x[k]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");g=R,E++}if(d[E]!==" "){for(var M=A-g;M!==A&&x[M]===0;)M++;for(var v=new Uint8Array(S+(A-M)),w=S;M!==A;)v[w++]=x[M++];return v}}}function p(d){var E=h(d);if(E)return E;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:h,decode:p}}var du=lu,hu=du,wi=hu;var Gn=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Zn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ei(this,t)}},Yn=class{decoders;constructor(t){this.decoders=t}or(t){return Ei(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Ei(e,t){return new Yn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Wn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Gn(t,r,n),this.decoder=new Zn(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Re({name:e,prefix:t,encode:r,decode:n}){return new Wn(e,t,r,n)}function re({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=wi(r,e);return Re({prefix:t,name:e,encode:n,decode:s=>zt(o(s))})}function pu(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,c=0,a=0;for(let u=0;u<o;++u){let f=t[e[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,i+=r,i>=8&&(i-=8,s[a++]=255&c>>i)}if(i>=r||(255&c<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function mu(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let a=0;a<e.length;++a)for(c=c<<8|e[a],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function yu(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function rt({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=yu(n);return Re({prefix:t,name:e,encode(s){return mu(s,n,r)},decode(s){return pu(s,o,r,e)}})}var nt=re({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bu=re({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xn={};Et(Xn,{base32:()=>ne,base32hex:()=>Eu,base32hexpad:()=>Su,base32hexpadupper:()=>Iu,base32hexupper:()=>vu,base32pad:()=>xu,base32padupper:()=>wu,base32upper:()=>gu,base32z:()=>Au});var ne=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gu=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xu=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wu=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Eu=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vu=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Su=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iu=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Au=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qn={};Et(Qn,{base36:()=>lr,base36upper:()=>_u});var lr=re({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_u=re({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Cu=Ii,vi=128,Du=127,Tu=~Du,Lu=Math.pow(2,31);function Ii(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Lu;)t[r++]=e&255|vi,e/=128;for(;e&Tu;)t[r++]=e&255|vi,e>>>=7;return t[r]=e|0,Ii.bytes=r-n+1,t}var Bu=Jn,Pu=128,Si=127;function Jn(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw Jn.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Si)<<o:(i&Si)*Math.pow(2,o),o+=7}while(i>=Pu);return Jn.bytes=s-n,r}var Ou=Math.pow(2,7),Ru=Math.pow(2,14),Nu=Math.pow(2,21),Uu=Math.pow(2,28),Ku=Math.pow(2,35),ku=Math.pow(2,42),Mu=Math.pow(2,49),Vu=Math.pow(2,56),Fu=Math.pow(2,63),qu=function(e){return e<Ou?1:e<Ru?2:e<Nu?3:e<Uu?4:e<Ku?5:e<ku?6:e<Mu?7:e<Vu?8:e<Fu?9:10},Hu={encode:Cu,decode:Bu,encodingLength:qu},zu=Hu,dr=zu;function hr(e,t=0){return[dr.decode(e,t),dr.decode.bytes]}function Ne(e,t,r=0){return dr.encode(e,t,r),t}function Ue(e){return dr.encodingLength(e)}function kt(e,t){let r=t.byteLength,n=Ue(e),o=n+Ue(r),s=new Uint8Array(o+r);return Ne(e,s,0),Ne(r,s,n),s.set(t,o),new Ke(e,r,t,s)}function pr(e){let t=zt(e),[r,n]=hr(t),[o,s]=hr(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Ke(r,o,i,t)}function Ai(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&yi(e.bytes,r.bytes)}}var Ke=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function _i(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Gu(r,to(e),t??nt.encoder);default:return Zu(r,to(e),t??ne.encoder)}}var Ci=new WeakMap;function to(e){let t=Ci.get(e);if(t==null){let r=new Map;return Ci.set(e,r),r}return t}var at=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==mr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Yu)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=kt(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&Ai(t.multihash,n.multihash)}toString(t){return _i(this,t)}toJSON(){return{"/":_i(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Di(n,o,s.bytes))}else if(r[Wu]===!0){let{version:n,multihash:o,code:s}=r,i=pr(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==mr)throw new Error(`Version 0 CID must use dag-pb (code: ${mr}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Di(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,mr,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=zt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new Ke(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[l,h]=hr(t.subarray(r));return r+=h,l},o=n(),s=mr;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),a=n(),u=r+a,f=u-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:f,size:u}}static parse(t,r){let[n,o]=$u(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return to(s).set(n,t),s}};function $u(e,t){switch(e[0]){case"Q":{let r=t??nt;return[nt.prefix,r.decode(`${nt.prefix}${e}`)]}case nt.prefix:{let r=t??nt;return[nt.prefix,r.decode(e)]}case ne.prefix:{let r=t??ne;return[ne.prefix,r.decode(e)]}case lr.prefix:{let r=t??lr;return[lr.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Gu(e,t,r){let{prefix:n}=r;if(n!==nt.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Zu(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var mr=112,Yu=18;function Di(e,t,r){let n=Ue(e),o=n+Ue(t),s=new Uint8Array(o+r.byteLength);return Ne(e,s,0),Ne(t,s,n),s.set(r,o),s}var Wu=Symbol.for("@ipld/js-cid/CID");var eo={};Et(eo,{identity:()=>Lt});var Ti=0,ju="identity",Li=zt;function Xu(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return kt(Ti,Li(e))}var Lt={code:Ti,name:ju,encode:Li,digest:Xu};function ct(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function ht(e=0){return new Uint8Array(e)}function vt(e=0){return new Uint8Array(e)}function $t(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=vt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var Pi=Symbol.for("@achingbrain/uint8arraylist");function Bi(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function Jr(e){return!!e?.[Pi]}var it=class e{bufs;length;[Pi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(Jr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(Jr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Bi(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Bi(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(Jr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return $t(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:$t(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let u=t>=c&&t<a,f=r>c&&r<=a;if(u&&f){if(t===c&&r===a){n.push(i);break}let l=t-c;n.push(i.subarray(l,l+(r-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(f){if(r===a){n.push(i);break}n.push(i.subarray(0,r-c));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!Jr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let c=i,a=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let l=r;l<=a;l+=f){f=0;for(let h=u;h>=0;h--){let p=this.get(l+h);if(n[h]!==p){f=Math.max(1,h-c[p]);break}}if(f===0)return l}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=vt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=ht(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=vt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=ht(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ct(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var ro={};Et(ro,{base10:()=>Qu});var Qu=re({prefix:"9",name:"base10",alphabet:"0123456789"});var no={};Et(no,{base16:()=>Ju,base16upper:()=>tf});var Ju=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tf=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var oo={};Et(oo,{base2:()=>ef});var ef=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var so={};Et(so,{base256emoji:()=>af});var Oi=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),rf=Oi.reduce((e,t,r)=>(e[r]=t,e),[]),nf=Oi.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function of(e){return e.reduce((t,r)=>(t+=rf[r],t),"")}function sf(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=nf[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var af=Re({prefix:"\u{1F680}",name:"base256emoji",encode:of,decode:sf});var ao={};Et(ao,{base64:()=>cf,base64pad:()=>uf,base64url:()=>io,base64urlpad:()=>ff});var cf=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),uf=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),io=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ff=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var co={};Et(co,{base8:()=>lf});var lf=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var uo={};Et(uo,{identity:()=>df});var df=Re({prefix:"\0",name:"identity",encode:e=>gi(e),decode:e=>bi(e)});var np=new TextEncoder,op=new TextDecoder;var ho={};Et(ho,{sha256:()=>yr,sha512:()=>yf});var mf=20;function lo({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new fo(e,t,r,n,o)}var fo=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??mf,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Ri(n,this.code,r?.truncate):n.then(o=>Ri(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Ri(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return kt(t,e)}function Ui(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var yr=lo({name:"sha2-256",code:18,encode:Ui("SHA-256")}),yf=lo({name:"sha2-512",code:19,encode:Ui("SHA-512")});var br={...uo,...oo,...co,...ro,...no,...Xn,...Qn,...jn,...ao,...so},yp={...ho,...eo};function ki(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Ki=ki("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),po=ki("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=vt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),bf={utf8:Ki,"utf-8":Ki,hex:br.base16,latin1:po,ascii:po,binary:po,...br},tn=bf;function F(e,t="utf8"){let r=tn[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function H(e,t="utf8"){let r=tn[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var gf=parseInt("11111",2),mo=parseInt("10000000",2),xf=parseInt("01111111",2),Mi={0:gr,1:gr,2:wf,3:Sf,4:If,5:vf,6:Ef,16:gr,22:gr,48:gr};function Gt(e,t={offset:0}){let r=e[t.offset]&gf;if(t.offset++,Mi[r]!=null)return Mi[r](e,t);throw new Error("No decoder for tag "+r)}function xr(e,t){let r=0;if((e[t.offset]&mo)===mo){let n=e[t.offset]&xf,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function gr(e,t){xr(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=Gt(e,t);if(n===null)break;r.push(n)}return r}function wf(e,t){let r=xr(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function Ef(e,t){let r=xr(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let u=e[t.offset];if(t.offset++,a.push(u&127),u<128){a.reverse();let f=0;for(let l=0;l<a.length;l++)f+=a[l]<<l*7;c+=`.${f}`,a=[]}}return c}function vf(e,t){return t.offset++,null}function Sf(e,t){let r=xr(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function If(e,t){let r=xr(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function Af(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new it;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function yo(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=Af(e.byteLength);return new it(Uint8Array.from([t.byteLength|mo]),t)}function St(e){let t=new it,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new it(Uint8Array.from([2]),yo(t),t)}function en(e){let t=Uint8Array.from([0]),r=new it(t,e);return new it(Uint8Array.from([3]),yo(r),r)}function oe(e,t=48){let r=new it;for(let n of e)r.append(n);return new it(Uint8Array.from([t]),yo(r),r)}async function Vi(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var _f=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Cf=Uint8Array.from([6,5,43,129,4,0,34]),Df=Uint8Array.from([6,5,43,129,4,0,35]),Tf={ext:!0,kty:"EC",crv:"P-256"},Lf={ext:!0,kty:"EC",crv:"P-384"},Bf={ext:!0,kty:"EC",crv:"P-521"},bo=32,go=48,xo=66;function wo(e){let t=Gt(e);return Fi(t)}function Fi(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===bo*2+1)return n=H(t.subarray(r,r+bo),"base64url"),o=H(t.subarray(r+bo),"base64url"),new ke({...Tf,key_ops:["verify"],x:n,y:o});if(t.byteLength===go*2+1)return n=H(t.subarray(r,r+go),"base64url"),o=H(t.subarray(r+go),"base64url"),new ke({...Lf,key_ops:["verify"],x:n,y:o});if(t.byteLength===xo*2+1)return n=H(t.subarray(r,r+xo),"base64url"),o=H(t.subarray(r+xo),"base64url"),new ke({...Bf,key_ops:["verify"],x:n,y:o});throw new Q(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function qi(e){return oe([St(Uint8Array.from([1])),oe([Pf(e.crv)],160),oe([en(new it(Uint8Array.from([4]),F(e.x??"","base64url"),F(e.y??"","base64url")))],161)]).subarray()}function Pf(e){if(e==="P-256")return _f;if(e==="P-384")return Cf;if(e==="P-521")return Df;throw new Q(`Invalid curve ${e}`)}var ke=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=qi(this.jwk)),this._raw}toMultihash(){return Lt.digest(Mt(this))}toCID(){return at.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}async verify(t,r,n){return Vi(this.jwk,r,t,n)}};function me(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Vt(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function K(e,t,r=""){let n=me(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,c=s?` of length ${t}`:"",a=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function rn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Vt(e.outputLen),Vt(e.blockLen)}function Me(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function zi(e,t){K(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function Yt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function nn(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Bt(e,t){return e<<32-t|e>>>t}var $i=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Of=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Wt(e){if(K(e),$i)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Of[e[r]];return t}var Zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hi(e){if(e>=Zt._0&&e<=Zt._9)return e-Zt._0;if(e>=Zt.A&&e<=Zt.F)return e-(Zt.A-10);if(e>=Zt.a&&e<=Zt.f)return e-(Zt.a-10)}function jt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if($i)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=Hi(e.charCodeAt(s)),c=Hi(e.charCodeAt(s+1));if(i===void 0||c===void 0){let a=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function It(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];K(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function Eo(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function Ve(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var vo=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function Gi(e,t,r){return e&t^~e&r}function Zi(e,t,r){return e&t^e&r^t&r}var wr=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=nn(this.buffer)}update(t){Me(this),K(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=nn(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Me(this),zi(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Yt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)r[l]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let c=nn(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Xt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var pt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var on=BigInt(4294967295),Yi=BigInt(32);function Rf(e,t=!1){return t?{h:Number(e&on),l:Number(e>>Yi&on)}:{h:Number(e>>Yi&on)|0,l:Number(e&on)|0}}function Wi(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=Rf(e[s],t);[n[s],o[s]]=[i,c]}return[n,o]}var So=(e,t,r)=>e>>>r,Io=(e,t,r)=>e<<32-r|t>>>r,ye=(e,t,r)=>e>>>r|t<<32-r,be=(e,t,r)=>e<<32-r|t>>>r,Er=(e,t,r)=>e<<64-r|t>>>r-32,vr=(e,t,r)=>e>>>r-32|t<<64-r;function Ft(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ji=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Xi=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Qi=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Ji=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,ta=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ea=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var Uf=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),se=new Uint32Array(64),Ao=class extends wr{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,r,n,o,s,i,c,a]}set(t,r,n,o,s,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let l=0;l<16;l++,r+=4)se[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let h=se[l-15],p=se[l-2],d=Bt(h,7)^Bt(h,18)^h>>>3,E=Bt(p,17)^Bt(p,19)^p>>>10;se[l]=E+se[l-7]+d+se[l-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){let h=Bt(c,6)^Bt(c,11)^Bt(c,25),p=f+h+Gi(c,a,u)+Uf[l]+se[l]|0,E=(Bt(n,2)^Bt(n,13)^Bt(n,22))+Zi(n,o,s)|0;f=u,u=a,a=c,c=i+p|0,i=s,s=o,o=n,n=p+E|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,o,s,i,c,a,u,f)}roundClean(){Yt(se)}destroy(){this.set(0,0,0,0,0,0,0,0),Yt(this.buffer)}},_o=class extends Ao{A=Xt[0]|0;B=Xt[1]|0;C=Xt[2]|0;D=Xt[3]|0;E=Xt[4]|0;F=Xt[5]|0;G=Xt[6]|0;H=Xt[7]|0;constructor(){super(32)}};var ra=Wi(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Kf=ra[0],kf=ra[1],ie=new Uint32Array(80),ae=new Uint32Array(80),Co=class extends wr{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:u,El:f,Fh:l,Fl:h,Gh:p,Gl:d,Hh:E,Hl:S}=this;return[t,r,n,o,s,i,c,a,u,f,l,h,p,d,E,S]}set(t,r,n,o,s,i,c,a,u,f,l,h,p,d,E,S){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=h|0,this.Gh=p|0,this.Gl=d|0,this.Hh=E|0,this.Hl=S|0}process(t,r){for(let x=0;x<16;x++,r+=4)ie[x]=t.getUint32(r),ae[x]=t.getUint32(r+=4);for(let x=16;x<80;x++){let _=ie[x-15]|0,R=ae[x-15]|0,k=ye(_,R,1)^ye(_,R,8)^So(_,R,7),M=be(_,R,1)^be(_,R,8)^Io(_,R,7),v=ie[x-2]|0,w=ae[x-2]|0,N=ye(v,w,19)^Er(v,w,61)^So(v,w,6),V=be(v,w,19)^vr(v,w,61)^Io(v,w,6),L=Qi(M,V,ae[x-7],ae[x-16]),y=Ji(L,k,N,ie[x-7],ie[x-16]);ie[x]=y|0,ae[x]=L|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:u,Dl:f,Eh:l,El:h,Fh:p,Fl:d,Gh:E,Gl:S,Hh:g,Hl:A}=this;for(let x=0;x<80;x++){let _=ye(l,h,14)^ye(l,h,18)^Er(l,h,41),R=be(l,h,14)^be(l,h,18)^vr(l,h,41),k=l&p^~l&E,M=h&d^~h&S,v=ta(A,R,M,kf[x],ae[x]),w=ea(v,g,_,k,Kf[x],ie[x]),N=v|0,V=ye(n,o,28)^Er(n,o,34)^Er(n,o,39),L=be(n,o,28)^vr(n,o,34)^vr(n,o,39),y=n&s^n&c^s&c,b=o&i^o&a^i&a;g=E|0,A=S|0,E=p|0,S=d|0,p=l|0,d=h|0,{h:l,l:h}=Ft(u|0,f|0,w|0,N|0),u=c|0,f=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let m=ji(N,L,b);n=Xi(m,w,V,y),o=m|0}({h:n,l:o}=Ft(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Ft(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=Ft(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l:f}=Ft(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:h}=Ft(this.Eh|0,this.El|0,l|0,h|0),{h:p,l:d}=Ft(this.Fh|0,this.Fl|0,p|0,d|0),{h:E,l:S}=Ft(this.Gh|0,this.Gl|0,E|0,S|0),{h:g,l:A}=Ft(this.Hh|0,this.Hl|0,g|0,A|0),this.set(n,o,s,i,c,a,u,f,l,h,p,d,E,S,g,A)}roundClean(){Yt(ie,ae)}destroy(){Yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Do=class extends Co{Ah=pt[0]|0;Al=pt[1]|0;Bh=pt[2]|0;Bl=pt[3]|0;Ch=pt[4]|0;Cl=pt[5]|0;Dh=pt[6]|0;Dl=pt[7]|0;Eh=pt[8]|0;El=pt[9]|0;Fh=pt[10]|0;Fl=pt[11]|0;Gh=pt[12]|0;Gl=pt[13]|0;Hh=pt[14]|0;Hl=pt[15]|0;constructor(){super(64)}};var Fe=Eo(()=>new _o,vo(1));var na=Eo(()=>new Do,vo(3));var Lo=BigInt(0),To=BigInt(1);function Qt(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function oa(e){if(typeof e=="bigint"){if(!sn(e))throw new Error("positive bigint expected, got "+e)}else Vt(e);return e}function Sr(e){let t=oa(e).toString(16);return t.length&1?"0"+t:t}function sa(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Lo:BigInt("0x"+e)}function qe(e){return sa(Wt(e))}function ge(e){return sa(Wt(cn(K(e)).reverse()))}function an(e,t){Vt(t),e=oa(e);let r=jt(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Bo(e,t){return an(e,t).reverse()}function cn(e){return Uint8Array.from(e)}var sn=e=>typeof e=="bigint"&&Lo<=e;function Mf(e,t,r){return sn(e)&&sn(t)&&sn(r)&&t<=e&&e<r}function Ir(e,t,r,n){if(!Mf(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Po(e){let t;for(t=0;e>Lo;e>>=To,t+=1);return t}var Ar=e=>(To<<BigInt(e))-To;function ia(e,t,r){if(Vt(e,"hashLen"),Vt(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=S=>new Uint8Array(S),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),c=1e3,a=n(e),u=n(e),f=0,l=()=>{a.fill(1),u.fill(0),f=0},h=(...S)=>r(u,It(a,...S)),p=(S=o)=>{u=h(s,S),a=h(),S.length!==0&&(u=h(i,S),a=h())},d=()=>{if(f++>=c)throw new Error("drbg: tried max amount of iterations");let S=0,g=[];for(;S<t;){a=h();let A=a.slice();g.push(A),S+=a.length}return It(...g)};return(S,g)=>{l(),p(S);let A;for(;!(A=g(d()));)p();return l(),A}}function ce(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,c){let a=e[s];if(c&&a===void 0)return;let u=typeof a;if(u!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${u}`)}let o=(s,i)=>Object.entries(s).forEach(([c,a])=>n(c,a,i));o(t,!1),o(r,!0)}function He(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var wt=BigInt(0),ut=BigInt(1),xe=BigInt(2),ua=BigInt(3),fa=BigInt(4),la=BigInt(5),Vf=BigInt(7),da=BigInt(8),Ff=BigInt(9),ha=BigInt(16);function ot(e,t){let r=e%t;return r>=wt?r:t+r}function X(e,t,r){let n=e;for(;t-- >wt;)n*=n,n%=r;return n}function aa(e,t){if(e===wt)throw new Error("invert: expected non-zero number");if(t<=wt)throw new Error("invert: expected positive modulus, got "+t);let r=ot(e,t),n=t,o=wt,s=ut,i=ut,c=wt;for(;r!==wt;){let u=n/r,f=n%r,l=o-i*u,h=s-c*u;n=r,r=f,o=i,s=c,i=l,c=h}if(n!==ut)throw new Error("invert: does not exist");return ot(o,t)}function Ro(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function pa(e,t){let r=(e.ORDER+ut)/fa,n=e.pow(t,r);return Ro(e,n,t),n}function qf(e,t){let r=(e.ORDER-la)/da,n=e.mul(t,xe),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,xe),o),c=e.mul(s,e.sub(i,e.ONE));return Ro(e,c,t),c}function Hf(e){let t=ze(e),r=ma(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+Vf)/ha;return(c,a)=>{let u=c.pow(a,i),f=c.mul(u,n),l=c.mul(u,o),h=c.mul(u,s),p=c.eql(c.sqr(f),a),d=c.eql(c.sqr(l),a);u=c.cmov(u,f,p),f=c.cmov(h,l,d);let E=c.eql(c.sqr(f),a),S=c.cmov(u,f,E);return Ro(c,S,a),S}}function ma(e){if(e<ua)throw new Error("sqrt is not defined for small field");let t=e-ut,r=0;for(;t%xe===wt;)t/=xe,r++;let n=xe,o=ze(e);for(;ca(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return pa;let s=o.pow(n,t),i=(t+ut)/xe;return function(a,u){if(a.is0(u))return u;if(ca(a,u)!==1)throw new Error("Cannot find square root");let f=r,l=a.mul(a.ONE,s),h=a.pow(u,t),p=a.pow(u,i);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,E=a.sqr(h);for(;!a.eql(E,a.ONE);)if(d++,E=a.sqr(E),d===f)throw new Error("Cannot find square root");let S=ut<<BigInt(f-d-1),g=a.pow(l,S);f=d,l=a.sqr(g),h=a.mul(h,l),p=a.mul(p,g)}return p}}function zf(e){return e%fa===ua?pa:e%da===la?qf:e%ha===Ff?Hf(e):ma(e)}var ya=(e,t)=>(ot(e,t)&ut)===ut,$f=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function No(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=$f.reduce((n,o)=>(n[o]="function",n),t);return ce(e,r),e}function Gf(e,t,r){if(r<wt)throw new Error("invalid exponent, negatives unsupported");if(r===wt)return e.ONE;if(r===ut)return t;let n=e.ONE,o=t;for(;r>wt;)r&ut&&(n=e.mul(n,o)),o=e.sqr(o),r>>=ut;return n}function _r(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),s),n}function ca(e,t){let r=(e.ORDER-ut)/xe,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Zf(e,t){t!==void 0&&Vt(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var Oo=class{ORDER;BITS;BYTES;isLE;ZERO=wt;ONE=ut;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=wt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=Zf(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return ot(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return wt<=t&&t<this.ORDER}is0(t){return t===wt}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&ut)===ut}neg(t){return ot(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return ot(t*t,this.ORDER)}add(t,r){return ot(t+r,this.ORDER)}sub(t,r){return ot(t-r,this.ORDER)}mul(t,r){return ot(t*r,this.ORDER)}pow(t,r){return Gf(this,t,r)}div(t,r){return ot(t*aa(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return aa(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=zf(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Bo(t,this.BYTES):an(t,this.BYTES)}fromBytes(t,r=!1){K(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:c}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let u=new Uint8Array(o);u.set(t,s?0:u.length-t.length),t=u}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let a=s?ge(t):qe(t);if(c&&(a=ot(a,i)),!r&&!this.isValid(a))throw new Error("invalid field element: outside of range 0..ORDER");return a}invertBatch(t){return _r(this,t)}cmov(t,r,n){return n?r:t}};function ze(e,t={}){return new Oo(e,t)}function ba(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Uo(e){let t=ba(e);return t+Math.ceil(t/2)}function Ko(e,t,r=!1){K(e);let n=e.length,o=ba(t),s=Uo(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?ge(e):qe(e),c=ot(i,t-ut)+ut;return r?Bo(c,o):an(c,o)}var $e=BigInt(0),we=BigInt(1);function Cr(e,t){let r=t.negate();return e?r:t}function Ee(e,t){let r=_r(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Ea(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ko(e,t){Ea(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Ar(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function ga(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(e&o),a=e>>i;c>n&&(c-=s,a+=we);let u=t*n,f=u+Math.abs(c)-1,l=c===0,h=c<0,p=t%2!==0;return{nextN:a,offset:f,isZero:l,isNeg:h,isNegF:p,offsetF:u}}var Mo=new WeakMap,va=new WeakMap;function Vo(e){return va.get(e)||1}function xa(e){if(e!==$e)throw new Error("invalid wNAF")}var Ge=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>$e;)r&we&&(n=n.add(o)),o=o.double(),r>>=we;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=ko(r,this.bits),s=[],i=t,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=ko(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:f,isNeg:l,isNegF:h,offsetF:p}=ga(n,c,i);n=a,f?s=s.add(Cr(h,r[p])):o=o.add(Cr(l,r[u]))}return xa(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=ko(t,this.bits);for(let i=0;i<s.windows&&n!==$e;i++){let{nextN:c,offset:a,isZero:u,isNeg:f}=ga(n,i,s);if(n=c,!u){let l=r[a];o=o.add(f?l.negate():l)}}return xa(n),o}getPrecomputes(t,r,n){let o=Mo.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),Mo.set(r,o))),o}cached(t,r,n){let o=Vo(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=Vo(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Ea(r,this.bits),va.set(t,r),Mo.delete(t)}hasCache(t){return Vo(t)!==1}};function Sa(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>$e||n>$e;)r&we&&(s=s.add(o)),n&we&&(i=i.add(o)),o=o.double(),r>>=we,n>>=we;return{p1:s,p2:i}}function wa(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return No(t),t}else return ze(e,{isLE:r})}function un(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let u=t[a];if(!(typeof u=="bigint"&&u>$e))throw new Error(`CURVE.${a} must be positive bigint`)}let o=wa(t.p,r.Fp,n),s=wa(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function fn(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var ue=BigInt(0),ft=BigInt(1),Fo=BigInt(2),Yf=BigInt(8);function Wf(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function Ia(e,t={}){let r=un("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;ce(t,{},{uvRatio:"function"});let c=Fo<<BigInt(o.BYTES*8)-ft,a=S=>n.create(S),u=t.uvRatio||((S,g)=>{try{return{isValid:!0,value:n.sqrt(n.div(S,g))}}catch{return{isValid:!1,value:ue}}});if(!Wf(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function f(S,g,A=!1){let x=A?ft:ue;return Ir("coordinate "+S,g,x,c),g}function l(S){if(!(S instanceof d))throw new Error("EdwardsPoint expected")}let h=He((S,g)=>{let{X:A,Y:x,Z:_}=S,R=S.is0();g==null&&(g=R?Yf:n.inv(_));let k=a(A*g),M=a(x*g),v=n.mul(_,g);if(R)return{x:ue,y:ft};if(v!==ft)throw new Error("invZ was invalid");return{x:k,y:M}}),p=He(S=>{let{a:g,d:A}=s;if(S.is0())throw new Error("bad point: ZERO");let{X:x,Y:_,Z:R,T:k}=S,M=a(x*x),v=a(_*_),w=a(R*R),N=a(w*w),V=a(M*g),L=a(w*a(V+v)),y=a(N+a(A*a(M*v)));if(L!==y)throw new Error("bad point: equation left != right (1)");let b=a(x*_),m=a(R*k);if(b!==m)throw new Error("bad point: equation left != right (2)");return!0});class d{static BASE=new d(s.Gx,s.Gy,ft,a(s.Gx*s.Gy));static ZERO=new d(ue,ft,ft,ue);static Fp=n;static Fn=o;X;Y;Z;T;constructor(g,A,x,_){this.X=f("x",g),this.Y=f("y",A),this.Z=f("z",x,!0),this.T=f("t",_),Object.freeze(this)}static CURVE(){return s}static fromAffine(g){if(g instanceof d)throw new Error("extended point not allowed");let{x:A,y:x}=g||{};return f("x",A),f("y",x),new d(A,x,ft,a(A*x))}static fromBytes(g,A=!1){let x=n.BYTES,{a:_,d:R}=s;g=cn(K(g,x,"point")),Qt(A,"zip215");let k=cn(g),M=g[x-1];k[x-1]=M&-129;let v=ge(k),w=A?c:n.ORDER;Ir("point.y",v,ue,w);let N=a(v*v),V=a(N-ft),L=a(R*N-_),{isValid:y,value:b}=u(V,L);if(!y)throw new Error("bad point: invalid y coordinate");let m=(b&ft)===ft,I=(M&128)!==0;if(!A&&b===ue&&I)throw new Error("bad point: x=0 and x_0=1");return I!==m&&(b=a(-b)),d.fromAffine({x:b,y:v})}static fromHex(g,A=!1){return d.fromBytes(jt(g),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(g=8,A=!0){return E.createCache(this,g),A||this.multiply(Fo),this}assertValidity(){p(this)}equals(g){l(g);let{X:A,Y:x,Z:_}=this,{X:R,Y:k,Z:M}=g,v=a(A*M),w=a(R*_),N=a(x*M),V=a(k*_);return v===w&&N===V}is0(){return this.equals(d.ZERO)}negate(){return new d(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:g}=s,{X:A,Y:x,Z:_}=this,R=a(A*A),k=a(x*x),M=a(Fo*a(_*_)),v=a(g*R),w=A+x,N=a(a(w*w)-R-k),V=v+k,L=V-M,y=v-k,b=a(N*L),m=a(V*y),I=a(N*y),C=a(L*V);return new d(b,m,C,I)}add(g){l(g);let{a:A,d:x}=s,{X:_,Y:R,Z:k,T:M}=this,{X:v,Y:w,Z:N,T:V}=g,L=a(_*v),y=a(R*w),b=a(M*x*V),m=a(k*N),I=a((_+R)*(v+w)-L-y),C=m-b,T=m+b,B=a(y-A*L),D=a(I*C),O=a(T*B),U=a(I*B),J=a(C*T);return new d(D,O,J,U)}subtract(g){return this.add(g.negate())}multiply(g){if(!o.isValidNot0(g))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:A,f:x}=E.cached(this,g,_=>Ee(d,_));return Ee(d,[A,x])[0]}multiplyUnsafe(g,A=d.ZERO){if(!o.isValid(g))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return g===ue?d.ZERO:this.is0()||g===ft?this:E.unsafe(this,g,x=>Ee(d,x),A)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return E.unsafe(this,s.n).is0()}toAffine(g){return h(this,g)}clearCofactor(){return i===ft?this:this.multiplyUnsafe(i)}toBytes(){let{x:g,y:A}=this.toAffine(),x=n.toBytes(A);return x[x.length-1]|=g&ft?128:0,x}toHex(){return Wt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let E=new Ge(d,o.BITS);return d.BASE.precompute(8),d}function Aa(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');ce(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,c=r.randomBytes||Ve,a=r.adjustScalarBytes||(v=>v),u=r.domain||((v,w,N)=>{if(Qt(N,"phflag"),w.length||N)throw new Error("Contexts/pre-hash are not supported");return v});function f(v){return i.create(ge(v))}function l(v){let w=x.secretKey;K(v,x.secretKey,"secretKey");let N=K(t(v),2*w,"hashedSecretKey"),V=a(N.slice(0,w)),L=N.slice(w,2*w),y=f(V);return{head:V,prefix:L,scalar:y}}function h(v){let{head:w,prefix:N,scalar:V}=l(v),L=o.multiply(V),y=L.toBytes();return{head:w,prefix:N,scalar:V,point:L,pointBytes:y}}function p(v){return h(v).pointBytes}function d(v=Uint8Array.of(),...w){let N=It(...w);return f(t(u(N,K(v,void 0,"context"),!!n)))}function E(v,w,N={}){v=K(v,void 0,"message"),n&&(v=n(v));let{prefix:V,scalar:L,pointBytes:y}=h(w),b=d(N.context,V,v),m=o.multiply(b).toBytes(),I=d(N.context,m,y,v),C=i.create(b+I*L);if(!i.isValid(C))throw new Error("sign failed: invalid s");let T=It(m,i.toBytes(C));return K(T,x.signature,"result")}let S={zip215:!0};function g(v,w,N,V=S){let{context:L,zip215:y}=V,b=x.signature;v=K(v,b,"signature"),w=K(w,void 0,"message"),N=K(N,x.publicKey,"publicKey"),y!==void 0&&Qt(y,"zip215"),n&&(w=n(w));let m=b/2,I=v.subarray(0,m),C=ge(v.subarray(m,b)),T,B,D;try{T=e.fromBytes(N,y),B=e.fromBytes(I,y),D=o.multiplyUnsafe(C)}catch{return!1}if(!y&&T.isSmallOrder())return!1;let O=d(L,B.toBytes(),T.toBytes(),w);return B.add(T.multiplyUnsafe(O)).subtract(D).clearCofactor().is0()}let A=s.BYTES,x={secretKey:A,publicKey:A,signature:2*A,seed:A};function _(v=c(x.seed)){return K(v,x.seed,"seed")}function R(v){return me(v)&&v.length===i.BYTES}function k(v,w){try{return!!e.fromBytes(v,w)}catch{return!1}}let M={getExtendedPublicKey:h,randomSecretKey:_,isValidSecretKey:R,isValidPublicKey:k,toMontgomery(v){let{y:w}=e.fromBytes(v),N=x.publicKey,V=N===32;if(!V&&N!==57)throw new Error("only defined for 25519 and 448");let L=V?s.div(ft+w,ft-w):s.div(w-ft,w+ft);return s.toBytes(L)},toMontgomerySecret(v){let w=x.secretKey;K(v,w);let N=t(v.subarray(0,w));return a(N).subarray(0,w)}};return Object.freeze({keygen:fn(_,p),getPublicKey:p,sign:E,verify:g,utils:M,Point:e,lengths:x})}var jf=BigInt(1),_a=BigInt(2);var Xf=BigInt(5),Qf=BigInt(8),qo=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Jf={p:qo,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Qf,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function tl(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=qo,c=e*e%s*e%s,a=X(c,_a,s)*c%s,u=X(a,jf,s)*e%s,f=X(u,Xf,s)*u%s,l=X(f,t,s)*f%s,h=X(l,r,s)*l%s,p=X(h,n,s)*h%s,d=X(p,o,s)*p%s,E=X(d,o,s)*p%s,S=X(E,t,s)*f%s;return{pow_p_5_8:X(S,_a,s)*e%s,b2:c}}function el(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Ca=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function rl(e,t){let r=qo,n=ot(t*t*t,r),o=ot(n*n*t,r),s=tl(e*o).pow_p_5_8,i=ot(e*n*s,r),c=ot(t*i*i,r),a=i,u=ot(i*Ca,r),f=c===e,l=c===ot(-e,r),h=c===ot(-e*Ca,r);return f&&(i=a),(l||h)&&(i=u),ya(i,r)&&(i=ot(-i,r)),{isValid:f||l,value:i}}var nl=Ia(Jf,{uvRatio:rl});function ol(e){return Aa(nl,na,Object.assign({adjustScalarBytes:el},e))}var Da=ol({});var Dr=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},ln=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Ta={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new ln("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var Dt=Ta;var dn=32;var Ho,sl=(async()=>{try{return await Dt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function il(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await Dt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await Dt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function al(e,t,r){return Da.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function La(e,t,r){return Ho==null&&(Ho=await sl),Ho?il(e,t,r):al(e,t,r)}function hn(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var pn=class{type="Ed25519";raw;constructor(t){this.raw=zo(t,dn)}toMultihash(){return Lt.digest(Mt(this))}toCID(){return at.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=La(this.raw,r,t);return hn(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function $o(e){return e=zo(e,dn),new pn(e)}function zo(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new Q(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var ul=Math.pow(2,7),fl=Math.pow(2,14),ll=Math.pow(2,21),Go=Math.pow(2,28),Zo=Math.pow(2,35),Yo=Math.pow(2,42),Wo=Math.pow(2,49),G=128,bt=127;function At(e){if(e<ul)return 1;if(e<fl)return 2;if(e<ll)return 3;if(e<Go)return 4;if(e<Zo)return 5;if(e<Yo)return 6;if(e<Wo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Ze(e,t,r=0){switch(At(e)){case 8:t[r++]=e&255|G,e/=128;case 7:t[r++]=e&255|G,e/=128;case 6:t[r++]=e&255|G,e/=128;case 5:t[r++]=e&255|G,e/=128;case 4:t[r++]=e&255|G,e>>>=7;case 3:t[r++]=e&255|G,e>>>=7;case 2:t[r++]=e&255|G,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function dl(e,t,r=0){switch(At(e)){case 8:t.set(r++,e&255|G),e/=128;case 7:t.set(r++,e&255|G),e/=128;case 6:t.set(r++,e&255|G),e/=128;case 5:t.set(r++,e&255|G),e/=128;case 4:t.set(r++,e&255|G),e>>>=7;case 3:t.set(r++,e&255|G),e>>>=7;case 2:t.set(r++,e&255|G),e>>>=7;case 1:{t.set(r++,e&255),e>>>=7;break}default:throw new Error("unreachable")}return t}function jo(e,t){let r=e[t],n=0;if(n+=r&bt,r<G||(r=e[t+1],n+=(r&bt)<<7,r<G)||(r=e[t+2],n+=(r&bt)<<14,r<G)||(r=e[t+3],n+=(r&bt)<<21,r<G)||(r=e[t+4],n+=(r&bt)*Go,r<G)||(r=e[t+5],n+=(r&bt)*Zo,r<G)||(r=e[t+6],n+=(r&bt)*Yo,r<G)||(r=e[t+7],n+=(r&bt)*Wo,r<G))return n;throw new RangeError("Could not decode varint")}function hl(e,t){let r=e.get(t),n=0;if(n+=r&bt,r<G||(r=e.get(t+1),n+=(r&bt)<<7,r<G)||(r=e.get(t+2),n+=(r&bt)<<14,r<G)||(r=e.get(t+3),n+=(r&bt)<<21,r<G)||(r=e.get(t+4),n+=(r&bt)*Go,r<G)||(r=e.get(t+5),n+=(r&bt)*Zo,r<G)||(r=e.get(t+6),n+=(r&bt)*Yo,r<G)||(r=e.get(t+7),n+=(r&bt)*Wo,r<G))return n;throw new RangeError("Could not decode varint")}function Ye(e,t,r=0){return t==null&&(t=vt(At(e))),t instanceof Uint8Array?Ze(e,t,r):dl(e,t,r)}function Tr(e,t=0){return e instanceof Uint8Array?jo(e,t):hl(e,t)}var Qo=new Float32Array([-0]),fe=new Uint8Array(Qo.buffer);function Pa(e,t,r){Qo[0]=e,t[r]=fe[0],t[r+1]=fe[1],t[r+2]=fe[2],t[r+3]=fe[3]}function Oa(e,t){return fe[0]=e[t],fe[1]=e[t+1],fe[2]=e[t+2],fe[3]=e[t+3],Qo[0]}var Jo=new Float64Array([-0]),gt=new Uint8Array(Jo.buffer);function Ra(e,t,r){Jo[0]=e,t[r]=gt[0],t[r+1]=gt[1],t[r+2]=gt[2],t[r+3]=gt[3],t[r+4]=gt[4],t[r+5]=gt[5],t[r+6]=gt[6],t[r+7]=gt[7]}function Na(e,t){return gt[0]=e[t],gt[1]=e[t+1],gt[2]=e[t+2],gt[3]=e[t+3],gt[4]=e[t+4],gt[5]=e[t+5],gt[6]=e[t+6],gt[7]=e[t+7],Jo[0]}var pl=BigInt(Number.MAX_SAFE_INTEGER),ml=BigInt(Number.MIN_SAFE_INTEGER),Ct=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return ve;if(t<pl&&t>ml)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>Ua&&(o=0n,++n>Ua&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return ve;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):ve}},ve=new Ct(0,0);ve.toBigInt=function(){return 0n};ve.zzEncode=ve.zzDecode=function(){return this};ve.length=function(){return 1};var Ua=4294967296n;function Ka(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function ka(e,t,r){if(r-t<1)return"";let o,s=[],i=0,c;for(;t<r;)c=e[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function ts(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Pt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function mn(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var es=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Pt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Pt(this,4);return mn(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Pt(this,4);return mn(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Pt(this,4);let t=Oa(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Pt(this,4);let t=Na(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Pt(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return ka(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Pt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Pt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Ct(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Pt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Pt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Pt(this,8);let t=mn(this.buf,this.pos+=4),r=mn(this.buf,this.pos+=4);return new Ct(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=jo(this.buf,this.pos);return this.pos+=At(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function rs(e){return new es(e instanceof Uint8Array?e:e.subarray())}function Ot(e,t,r){let n=rs(e);return t.decode(n,void 0,r)}function ns(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return vt(i);o+i>t&&(n=vt(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var Se=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function os(){}var is=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},yl=ns();function bl(e){return globalThis.Buffer!=null?vt(e):yl(e)}var Br=class{len;head;tail;states;constructor(){this.len=0,this.head=new Se(os,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new Se(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new as((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(yn,10,Ct.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=Ct.fromBigInt(t);return this._push(yn,r.length(),r)}uint64Number(t){return this._push(Ze,At(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=Ct.fromBigInt(t).zzEncode();return this._push(yn,r.length(),r)}sint64Number(t){let r=Ct.fromNumber(t).zzEncode();return this._push(yn,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(ss,1,t?1:0)}fixed32(t){return this._push(Lr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=Ct.fromBigInt(t);return this._push(Lr,4,r.lo)._push(Lr,4,r.hi)}fixed64Number(t){let r=Ct.fromNumber(t);return this._push(Lr,4,r.lo)._push(Lr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Pa,4,t)}double(t){return this._push(Ra,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(ss,1,0):this.uint32(r)._push(xl,r,t)}string(t){let r=Ka(t);return r!==0?this.uint32(r)._push(ts,r,t):this._push(ss,1,0)}fork(){return this.states=new is(this),this.head=this.tail=new Se(os,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Se(os,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=bl(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function ss(e,t,r){t[r]=e&255}function gl(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var as=class extends Se{next;constructor(t,r){super(gl,t,r),this.next=void 0}};function yn(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Lr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function xl(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Br.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(wl,t,e),this},Br.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(El,t,e),this});function wl(e,t,r){t.set(e,r)}function El(e,t,r){e.length<40?ts(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(F(e),r)}function cs(){return new Br}function Rt(e,t){let r=cs();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var We;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(We||(We={}));function bn(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function us(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return bn("enum",We.VARINT,r,n)}function Nt(e,t){return bn("message",We.LENGTH_DELIMITED,e,t)}var Ie=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var st;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(st||(st={}));var fs;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(fs||(fs={}));(function(e){e.codec=()=>us(fs)})(st||(st={}));var qt;(function(e){let t;e.codec=()=>(t==null&&(t=Nt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),st.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Rt(r,e.codec()),e.decode=(r,n)=>Ot(r,e.codec(),n)})(qt||(qt={}));var ls;(function(e){let t;e.codec=()=>(t==null&&(t=Nt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),st.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Rt(r,e.codec()),e.decode=(r,n)=>Ot(r,e.codec(),n)})(ls||(ls={}));var Or={};Et(Or,{MAX_RSA_KEY_SIZE:()=>ds,generateRSAKeyPair:()=>za,jwkToJWKKeyPair:()=>$a,jwkToPkcs1:()=>Al,jwkToPkix:()=>ys,jwkToRSAPrivateKey:()=>ws,pkcs1MessageToJwk:()=>ps,pkcs1MessageToRSAPrivateKey:()=>bs,pkcs1ToJwk:()=>Il,pkcs1ToRSAPrivateKey:()=>Ha,pkixMessageToJwk:()=>ms,pkixMessageToRSAPublicKey:()=>xs,pkixToJwk:()=>_l,pkixToRSAPublicKey:()=>gs});var je=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=Or.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return at.createV1(114,this._multihash)}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return qa(this.jwk,r,t,n)}},Pr=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=Or.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}sign(t,r){return Fa(this.jwk,t,r)}};var ds=8192,hs=18,vl=1062,Sl=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Il(e){let t=Gt(e);return ps(t)}function ps(e){return{n:H(e[1],"base64url"),e:H(e[2],"base64url"),d:H(e[3],"base64url"),p:H(e[4],"base64url"),q:H(e[5],"base64url"),dp:H(e[6],"base64url"),dq:H(e[7],"base64url"),qi:H(e[8],"base64url"),kty:"RSA"}}function Al(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new Q("JWK was missing components");return oe([St(Uint8Array.from([0])),St(F(e.n,"base64url")),St(F(e.e,"base64url")),St(F(e.d,"base64url")),St(F(e.p,"base64url")),St(F(e.q,"base64url")),St(F(e.dp,"base64url")),St(F(e.dq,"base64url")),St(F(e.qi,"base64url"))]).subarray()}function _l(e){let t=Gt(e,{offset:0});return ms(t)}function ms(e){let t=Gt(e[1],{offset:0});return{kty:"RSA",n:H(t[0],"base64url"),e:H(t[1],"base64url")}}function ys(e){if(e.n==null||e.e==null)throw new Q("JWK was missing components");return oe([Sl,en(oe([St(F(e.n,"base64url")),St(F(e.e,"base64url"))]))]).subarray()}function Ha(e){let t=Gt(e);return bs(t)}function bs(e){let t=ps(e);return ws(t)}function gs(e,t){if(e.byteLength>=vl)throw new Oe("Key size is too large");let r=Gt(e,{offset:0});return xs(r,e,t)}function xs(e,t,r){let n=ms(e);if(r==null){let o=Fe(qt.encode({Type:st.RSA,Data:t}));r=kt(hs,o)}return new je(n,r)}function ws(e){if(Za(e)>ds)throw new Q("Key size is too large");let t=$a(e),r=Fe(qt.encode({Type:st.RSA,Data:ys(t.publicKey)})),n=kt(hs,r);return new Pr(t.privateKey,new je(t.publicKey,n))}async function za(e){if(e>ds)throw new Q("Key size is too large");let t=await Ga(e),r=Fe(qt.encode({Type:st.RSA,Data:ys(t.publicKey)})),n=kt(hs,r);return new Pr(t.privateKey,new je(t.publicKey,n))}function $a(e){if(e==null)throw new Q("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function Ga(e,t){let r=await Dt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await Cl(r,t);return{privateKey:n[0],publicKey:n[1]}}async function Fa(e,t,r){let n=await Dt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await Dt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function qa(e,t,r,n){let o=await Dt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await Dt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function Cl(e,t){if(e.privateKey==null||e.publicKey==null)throw new Q("Private and public key are required");let r=await Promise.all([Dt.get().subtle.exportKey("jwk",e.privateKey),Dt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function Za(e){if(e.kty!=="RSA")throw new Q("invalid key type");if(e.n==null)throw new Q("invalid key modulus");return F(e.n,"base64url").length*8}var gn=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(rn(t),K(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),Yt(o)}update(t){return Me(this),this.iHash.update(t),this}digestInto(t){Me(this),K(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Es=(e,t,r)=>new gn(e,t).update(r).digest();Es.create=(e,t)=>new gn(e,t);var Ya=(e,t)=>(e+(e>=0?t:-t)/Wa)/t;function Dl(e,t,r){let[[n,o],[s,i]]=t,c=Ya(i*e,r),a=Ya(-o*e,r),u=e-c*n-a*s,f=-c*o-a*i,l=u<Jt,h=f<Jt;l&&(u=-u),h&&(f=-f);let p=Ar(Math.ceil(Po(r)/2))+Xe;if(u<Jt||u>=p||f<Jt||f>=p)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:l,k1:u,k2neg:h,k2:f}}function Ss(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function vs(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return Qt(r.lowS,"lowS"),Qt(r.prehash,"prehash"),r.format!==void 0&&Ss(r.format),r}var Is=class extends Error{constructor(t=""){super(t)}},le={Err:Is,_tlv:{encode:(e,t)=>{let{Err:r}=le;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Sr(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Sr(o.length/2|128):"";return Sr(e)+s+o+t},decode(e,t){let{Err:r}=le,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+a);if(u.length!==a)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let f of u)i=i<<8|f;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=le;if(e<Jt)throw new t("integer: negative integers are not allowed");let r=Sr(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=le;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return qe(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=le,o=K(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:u,l:f}=n.decode(2,a);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=le,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Jt=BigInt(0),Xe=BigInt(1),Wa=BigInt(2),xn=BigInt(3),Tl=BigInt(4);function ja(e,t={}){let r=un("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;ce(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:a}=t;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=Qa(n,o);function f(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(L,y,b){let{x:m,y:I}=y.toAffine(),C=n.toBytes(m);if(Qt(b,"isCompressed"),b){f();let T=!n.isOdd(I);return It(Xa(T),C)}else return It(Uint8Array.of(4),C,n.toBytes(I))}function h(L){K(L,void 0,"Point");let{publicKey:y,publicKeyUncompressed:b}=u,m=L.length,I=L[0],C=L.subarray(1);if(m===y&&(I===2||I===3)){let T=n.fromBytes(C);if(!n.isValid(T))throw new Error("bad point: is not on curve, wrong x");let B=E(T),D;try{D=n.sqrt(B)}catch(J){let j=J instanceof Error?": "+J.message:"";throw new Error("bad point: is not on curve, sqrt error"+j)}f();let O=n.isOdd(D);return(I&1)===1!==O&&(D=n.neg(D)),{x:T,y:D}}else if(m===b&&I===4){let T=n.BYTES,B=n.fromBytes(C.subarray(0,T)),D=n.fromBytes(C.subarray(T,T*2));if(!S(B,D))throw new Error("bad point: is not on curve");return{x:B,y:D}}else throw new Error(`bad point: got length ${m}, expected compressed=${y} or uncompressed=${b}`)}let p=t.toBytes||l,d=t.fromBytes||h;function E(L){let y=n.sqr(L),b=n.mul(y,L);return n.add(n.add(b,n.mul(L,s.a)),s.b)}function S(L,y){let b=n.sqr(y),m=E(L);return n.eql(b,m)}if(!S(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let g=n.mul(n.pow(s.a,xn),Tl),A=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(g,A)))throw new Error("bad curve params: a or b");function x(L,y,b=!1){if(!n.isValid(y)||b&&n.is0(y))throw new Error(`bad point coordinate ${L}`);return y}function _(L){if(!(L instanceof w))throw new Error("Weierstrass Point expected")}function R(L){if(!a||!a.basises)throw new Error("no endo");return Dl(L,a.basises,o.ORDER)}let k=He((L,y)=>{let{X:b,Y:m,Z:I}=L;if(n.eql(I,n.ONE))return{x:b,y:m};let C=L.is0();y==null&&(y=C?n.ONE:n.inv(I));let T=n.mul(b,y),B=n.mul(m,y),D=n.mul(I,y);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(D,n.ONE))throw new Error("invZ was invalid");return{x:T,y:B}}),M=He(L=>{if(L.is0()){if(t.allowInfinityPoint&&!n.is0(L.Y))return;throw new Error("bad point: ZERO")}let{x:y,y:b}=L.toAffine();if(!n.isValid(y)||!n.isValid(b))throw new Error("bad point: x or y not field elements");if(!S(y,b))throw new Error("bad point: equation left != right");if(!L.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function v(L,y,b,m,I){return b=new w(n.mul(b.X,L),b.Y,b.Z),y=Cr(m,y),b=Cr(I,b),y.add(b)}class w{static BASE=new w(s.Gx,s.Gy,n.ONE);static ZERO=new w(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(y,b,m){this.X=x("x",y),this.Y=x("y",b,!0),this.Z=x("z",m),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){let{x:b,y:m}=y||{};if(!y||!n.isValid(b)||!n.isValid(m))throw new Error("invalid affine point");if(y instanceof w)throw new Error("projective point not allowed");return n.is0(b)&&n.is0(m)?w.ZERO:new w(b,m,n.ONE)}static fromBytes(y){let b=w.fromAffine(d(K(y,void 0,"point")));return b.assertValidity(),b}static fromHex(y){return w.fromBytes(jt(y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,b=!0){return V.createCache(this,y),b||this.multiply(xn),this}assertValidity(){M(this)}hasEvenY(){let{y}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(y)}equals(y){_(y);let{X:b,Y:m,Z:I}=this,{X:C,Y:T,Z:B}=y,D=n.eql(n.mul(b,B),n.mul(C,I)),O=n.eql(n.mul(m,B),n.mul(T,I));return D&&O}negate(){return new w(this.X,n.neg(this.Y),this.Z)}double(){let{a:y,b}=s,m=n.mul(b,xn),{X:I,Y:C,Z:T}=this,B=n.ZERO,D=n.ZERO,O=n.ZERO,U=n.mul(I,I),J=n.mul(C,C),j=n.mul(T,T),$=n.mul(I,C);return $=n.add($,$),O=n.mul(I,T),O=n.add(O,O),B=n.mul(y,O),D=n.mul(m,j),D=n.add(B,D),B=n.sub(J,D),D=n.add(J,D),D=n.mul(B,D),B=n.mul($,B),O=n.mul(m,O),j=n.mul(y,j),$=n.sub(U,j),$=n.mul(y,$),$=n.add($,O),O=n.add(U,U),U=n.add(O,U),U=n.add(U,j),U=n.mul(U,$),D=n.add(D,U),j=n.mul(C,T),j=n.add(j,j),U=n.mul(j,$),B=n.sub(B,U),O=n.mul(j,J),O=n.add(O,O),O=n.add(O,O),new w(B,D,O)}add(y){_(y);let{X:b,Y:m,Z:I}=this,{X:C,Y:T,Z:B}=y,D=n.ZERO,O=n.ZERO,U=n.ZERO,J=s.a,j=n.mul(s.b,xn),$=n.mul(b,C),tt=n.mul(m,T),dt=n.mul(I,B),Kt=n.add(b,m),et=n.add(C,T);Kt=n.mul(Kt,et),et=n.add($,tt),Kt=n.sub(Kt,et),et=n.add(b,I);let yt=n.add(C,B);return et=n.mul(et,yt),yt=n.add($,dt),et=n.sub(et,yt),yt=n.add(m,I),D=n.add(T,B),yt=n.mul(yt,D),D=n.add(tt,dt),yt=n.sub(yt,D),U=n.mul(J,et),D=n.mul(j,dt),U=n.add(D,U),D=n.sub(tt,U),U=n.add(tt,U),O=n.mul(D,U),tt=n.add($,$),tt=n.add(tt,$),dt=n.mul(J,dt),et=n.mul(j,et),tt=n.add(tt,dt),dt=n.sub($,dt),dt=n.mul(J,dt),et=n.add(et,dt),$=n.mul(tt,et),O=n.add(O,$),$=n.mul(yt,et),D=n.mul(Kt,D),D=n.sub(D,$),$=n.mul(Kt,tt),U=n.mul(yt,U),U=n.add(U,$),new w(D,O,U)}subtract(y){return this.add(y.negate())}is0(){return this.equals(w.ZERO)}multiply(y){let{endo:b}=t;if(!o.isValidNot0(y))throw new Error("invalid scalar: out of range");let m,I,C=T=>V.cached(this,T,B=>Ee(w,B));if(b){let{k1neg:T,k1:B,k2neg:D,k2:O}=R(y),{p:U,f:J}=C(B),{p:j,f:$}=C(O);I=J.add($),m=v(b.beta,U,j,T,D)}else{let{p:T,f:B}=C(y);m=T,I=B}return Ee(w,[m,I])[0]}multiplyUnsafe(y){let{endo:b}=t,m=this;if(!o.isValid(y))throw new Error("invalid scalar: out of range");if(y===Jt||m.is0())return w.ZERO;if(y===Xe)return m;if(V.hasCache(this))return this.multiply(y);if(b){let{k1neg:I,k1:C,k2neg:T,k2:B}=R(y),{p1:D,p2:O}=Sa(w,m,C,B);return v(b.beta,D,O,I,T)}else return V.unsafe(m,y)}toAffine(y){return k(this,y)}isTorsionFree(){let{isTorsionFree:y}=t;return i===Xe?!0:y?y(w,this):V.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:y}=t;return i===Xe?this:y?y(w,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(y=!0){return Qt(y,"isCompressed"),this.assertValidity(),p(w,this,y)}toHex(y=!0){return Wt(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let N=o.BITS,V=new Ge(w,t.endo?Math.ceil(N/2):N);return w.BASE.precompute(8),w}function Xa(e){return Uint8Array.of(e?2:3)}function Qa(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function Ll(e,t={}){let{Fn:r}=e,n=t.randomBytes||Ve,o=Object.assign(Qa(e.Fp,r),{seed:Uo(r.ORDER)});function s(p){try{let d=r.fromBytes(p);return r.isValidNot0(d)}catch{return!1}}function i(p,d){let{publicKey:E,publicKeyUncompressed:S}=o;try{let g=p.length;return d===!0&&g!==E||d===!1&&g!==S?!1:!!e.fromBytes(p)}catch{return!1}}function c(p=n(o.seed)){return Ko(K(p,o.seed,"seed"),r.ORDER)}function a(p,d=!0){return e.BASE.multiply(r.fromBytes(p)).toBytes(d)}function u(p){let{secretKey:d,publicKey:E,publicKeyUncompressed:S}=o;if(!me(p)||"_lengths"in r&&r._lengths||d===E)return;let g=K(p,void 0,"key").length;return g===E||g===S}function f(p,d,E=!0){if(u(p)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");let S=r.fromBytes(p);return e.fromBytes(d).multiply(S).toBytes(E)}let l={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c},h=fn(c,a);return Object.freeze({getPublicKey:a,getSharedSecret:f,keygen:h,Point:e,utils:l,lengths:o})}function Ja(e,t,r={}){rn(t),ce(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||Ve,o=r.hmac||((b,m)=>Es(t,b,m)),{Fp:s,Fn:i}=e,{ORDER:c,BITS:a}=i,{keygen:u,getPublicKey:f,getSharedSecret:l,utils:h,lengths:p}=Ll(e,r),d={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},E=c*Wa<s.ORDER;function S(b){let m=c>>Xe;return b>m}function g(b,m){if(!i.isValidNot0(m))throw new Error(`invalid signature ${b}: out of range 1..Point.Fn.ORDER`);return m}function A(){if(E)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function x(b,m){Ss(m);let I=p.signature,C=m==="compact"?I:m==="recovered"?I+1:void 0;return K(b,C)}class _{r;s;recovery;constructor(m,I,C){if(this.r=g("r",m),this.s=g("s",I),C!=null){if(A(),![0,1,2,3].includes(C))throw new Error("invalid recovery id");this.recovery=C}Object.freeze(this)}static fromBytes(m,I=d.format){x(m,I);let C;if(I==="der"){let{r:O,s:U}=le.toSig(K(m));return new _(O,U)}I==="recovered"&&(C=m[0],I="compact",m=m.subarray(1));let T=p.signature/2,B=m.subarray(0,T),D=m.subarray(T,T*2);return new _(i.fromBytes(B),i.fromBytes(D),C)}static fromHex(m,I){return this.fromBytes(jt(m),I)}assertRecovery(){let{recovery:m}=this;if(m==null)throw new Error("invalid recovery id: must be present");return m}addRecoveryBit(m){return new _(this.r,this.s,m)}recoverPublicKey(m){let{r:I,s:C}=this,T=this.assertRecovery(),B=T===2||T===3?I+c:I;if(!s.isValid(B))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let D=s.toBytes(B),O=e.fromBytes(It(Xa((T&1)===0),D)),U=i.inv(B),J=k(K(m,void 0,"msgHash")),j=i.create(-J*U),$=i.create(C*U),tt=e.BASE.multiplyUnsafe(j).add(O.multiplyUnsafe($));if(tt.is0())throw new Error("invalid recovery: point at infinify");return tt.assertValidity(),tt}hasHighS(){return S(this.s)}toBytes(m=d.format){if(Ss(m),m==="der")return jt(le.hexFromSig(this));let{r:I,s:C}=this,T=i.toBytes(I),B=i.toBytes(C);return m==="recovered"?(A(),It(Uint8Array.of(this.assertRecovery()),T,B)):It(T,B)}toHex(m){return Wt(this.toBytes(m))}}let R=r.bits2int||function(m){if(m.length>8192)throw new Error("input is too large");let I=qe(m),C=m.length*8-a;return C>0?I>>BigInt(C):I},k=r.bits2int_modN||function(m){return i.create(R(m))},M=Ar(a);function v(b){return Ir("num < 2^"+a,b,Jt,M),i.toBytes(b)}function w(b,m){return K(b,void 0,"message"),m?K(t(b),void 0,"prehashed message"):b}function N(b,m,I){let{lowS:C,prehash:T,extraEntropy:B}=vs(I,d);b=w(b,T);let D=k(b),O=i.fromBytes(m);if(!i.isValidNot0(O))throw new Error("invalid private key");let U=[v(O),v(D)];if(B!=null&&B!==!1){let tt=B===!0?n(p.secretKey):B;U.push(K(tt,void 0,"extraEntropy"))}let J=It(...U),j=D;function $(tt){let dt=R(tt);if(!i.isValidNot0(dt))return;let Kt=i.inv(dt),et=e.BASE.multiply(dt).toAffine(),yt=i.create(et.x);if(yt===Jt)return;let Zr=i.create(Kt*i.create(j+yt*O));if(Zr===Jt)return;let hi=(et.x===yt?0:2)|Number(et.y&Xe),pi=Zr;return C&&S(Zr)&&(pi=i.neg(Zr),hi^=1),new _(yt,pi,E?void 0:hi)}return{seed:J,k2sig:$}}function V(b,m,I={}){let{seed:C,k2sig:T}=N(b,m,I);return ia(t.outputLen,i.BYTES,o)(C,T).toBytes(I.format)}function L(b,m,I,C={}){let{lowS:T,prehash:B,format:D}=vs(C,d);if(I=K(I,void 0,"publicKey"),m=w(m,B),!me(b)){let O=b instanceof _?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+O)}x(b,D);try{let O=_.fromBytes(b,D),U=e.fromBytes(I);if(T&&O.hasHighS())return!1;let{r:J,s:j}=O,$=k(m),tt=i.inv(j),dt=i.create($*tt),Kt=i.create(J*tt),et=e.BASE.multiplyUnsafe(dt).add(U.multiplyUnsafe(Kt));return et.is0()?!1:i.create(et.x)===J}catch{return!1}}function y(b,m,I={}){let{prehash:C}=vs(I,d);return m=w(m,C),_.fromBytes(b,"recovered").recoverPublicKey(m).toBytes()}return Object.freeze({keygen:u,getPublicKey:f,getSharedSecret:l,utils:h,lengths:p,Point:e,sign:V,verify:L,recoverPublicKey:y,Signature:_,hash:t})}var _s={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Bl={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var tc=BigInt(2);function Pl(e){let t=_s.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=X(f,r,t)*f%t,h=X(l,r,t)*f%t,p=X(h,tc,t)*u%t,d=X(p,o,t)*p%t,E=X(d,s,t)*d%t,S=X(E,c,t)*E%t,g=X(S,a,t)*S%t,A=X(g,c,t)*E%t,x=X(A,r,t)*f%t,_=X(x,i,t)*d%t,R=X(_,n,t)*u%t,k=X(R,tc,t);if(!As.eql(As.sqr(k),e))throw new Error("Cannot find square root");return k}var As=ze(_s.p,{sqrt:Pl}),Ol=ja(_s,{Fp:As,endo:Bl}),Qe=Ja(Ol,Fe);function ec(e,t,r,n){let o=yr.digest(r instanceof Uint8Array?r:r.subarray());if(hn(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Qe.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new Dr(String(s))});try{return n?.signal?.throwIfAborted(),Qe.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new Dr(String(s))}}var wn=class{type="secp256k1";raw;_key;constructor(t){this._key=nc(t),this.raw=rc(this._key)}toMultihash(){return Lt.digest(Mt(this))}toCID(){return at.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return ec(this._key,r,t,n)}};function Cs(e){return new wn(e)}function rc(e){return Qe.Point.fromBytes(e).toBytes()}function nc(e){try{return Qe.Point.fromBytes(e),e}catch(t){throw new Oe(String(t))}}function Je(e,t){let{Type:r,Data:n}=qt.decode(e),o=n??new Uint8Array;switch(r){case st.RSA:return gs(o,t);case st.Ed25519:return $o(o);case st.secp256k1:return Cs(o);case st.ECDSA:return wo(o);default:throw new he}}function oc(e){let{Type:t,Data:r}=qt.decode(e.digest),n=r??new Uint8Array;switch(t){case st.Ed25519:return $o(n);case st.secp256k1:return Cs(n);case st.ECDSA:return wo(n);default:throw new he}}function Mt(e){return qt.encode({Type:st[e.type],Data:e.raw})}var Rr;(function(e){let t;e.codec=()=>(t==null&&(t=Nt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.publicKey!=null&&r.publicKey.byteLength>0&&(n.uint32(10),n.bytes(r.publicKey)),r.payloadType!=null&&r.payloadType.byteLength>0&&(n.uint32(18),n.bytes(r.payloadType)),r.payload!=null&&r.payload.byteLength>0&&(n.uint32(26),n.bytes(r.payload)),r.signature!=null&&r.signature.byteLength>0&&(n.uint32(42),n.bytes(r.signature)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={publicKey:ht(0),payloadType:ht(0),payload:ht(0),signature:ht(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.publicKey=r.bytes();break}case 2:{s.payloadType=r.bytes();break}case 3:{s.payload=r.bytes();break}case 5:{s.signature=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Rt(r,e.codec()),e.decode=(r,n)=>Ot(r,e.codec(),n)})(Rr||(Rr={}));var En=class extends Error{constructor(t="Invalid signature"){super(t),this.name="InvalidSignatureError"}};var Ht=class e{static createFromProtobuf=t=>{let r=Rr.decode(t),n=Je(r.publicKey);return new e({publicKey:n,payloadType:r.payloadType,payload:r.payload,signature:r.signature})};static seal=async(t,r,n)=>{if(r==null)throw new Error("Missing private key");let o=t.domain,s=t.codec,i=t.marshal(),c=sc(o,s,i),a=await r.sign(c.subarray(),n);return new e({publicKey:r.publicKey,payloadType:s,payload:i,signature:a})};static openAndCertify=async(t,r,n)=>{let o=e.createFromProtobuf(t);if(!await o.validate(r,n))throw new En("Envelope signature is not valid for the given domain");return o};publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:r,payloadType:n,payload:o,signature:s}=t;this.publicKey=r,this.payloadType=n,this.payload=o,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Rr.encode({publicKey:Mt(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return t==null?!1:ct(this.marshal(),t.marshal())}async validate(t,r){let n=sc(t,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,r)}},sc=(e,t,r)=>{let n=F(e),o=Ye(n.byteLength),s=Ye(t.length),i=Ye(r.length);return new it(o,n,s,t,i,r)};var ic=Symbol.for("nodejs.util.inspect.custom"),Rl=114,Nr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[$n]=!0;toString(){return this.string==null&&(this.string=nt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return at.createV1(Rl,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ct(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ct(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[ic](){return`PeerId(${this.toString()})`}},Ur=class extends Nr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Kr=class extends Nr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},kr=class extends Nr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Nl=2336,Mr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Lt.digest(F(this.url))}[ic](){return`PeerId(${this.url})`}[$n]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return at.createV1(Nl,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=H(t)),t.toString()===this.toString())}};var Ul=114,ac=2336;function cc(e){if(e.type==="Ed25519")return new Kr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new kr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Ur({multihash:e.toCID().multihash,publicKey:e});throw new he}function Ds(e){if(kl(e))return new Ur({multihash:e});if(Kl(e))try{let t=oc(e);if(t.type==="Ed25519")return new Kr({multihash:e,publicKey:t});if(t.type==="secp256k1")return new kr({multihash:e,publicKey:t})}catch{let r=H(e.digest);return new Mr(new URL(r))}throw new jr("Supplied PeerID Multihash is invalid")}function vn(e){if(e?.multihash==null||e.version==null||e.version===1&&e.code!==Ul&&e.code!==ac)throw new Wr("Supplied PeerID CID is invalid");if(e.code===ac){let t=H(e.multihash.digest);return new Mr(new URL(t))}return Ds(e.multihash)}function Kl(e){return e.code===Lt.code}function kl(e){return e.code===yr.code}var mt=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},te=class extends Error{static name="ValidationError";name="ValidationError"},Sn=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},In=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var An=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,c=this.peekChar();if(c===void 0)return;let a=c==="0",u=2**(8*o)-1;for(;;){let f=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let h=Number.parseInt(l,t);if(!Number.isNaN(h))return h});if(f===void 0)break;if(s*=t,s+=f,s>u||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&a&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[c]=t(s.subarray(0,i));return r.set(s.subarray(0,c),16-c),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var uc=45,Ml=15,tr=new An;function _n(e){if(!(e.length>Ml))return tr.new(e).parseWith(()=>tr.readIPv4Addr())}function Cn(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>uc))return tr.new(e).parseWith(()=>tr.readIPv6Addr())}function er(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>uc)return;let r=tr.new(e).parseWith(()=>tr.readIPAddr());if(r)return t&&r.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r}function rr(e){return!!_n(e)}function Dn(e){return!!Cn(e)}function Ls(e){return t=>H(t,e)}function Bs(e){return t=>F(t,e)}function nr(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function Ae(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function fc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=F(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ae(n);return $t([r,o],r.length+o.length)}function lc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=ne.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ae(n);return $t([r,o],r.length+o.length)}function Ps(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=H(t,"base32"),o=nr(r);return`${n}:${o}`}var Os=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new mt("Invalid byte value in IP address");t[n]=o}),t},dc=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=rr(r[n]),i;s&&(i=Os(r[n]),r[n]=H(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,H(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new mt("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},hc=function(e){if(e.byteLength!==4)throw new mt("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},pc=function(e){if(e.byteLength!==16)throw new mt("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new mt(`Invalid IPv6 address "${r}"`)}};function mc(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new mt(`Invalid IPv6 address "${e}"`)}}var Ts=Object.values(br).map(e=>e.decoder),Vl=(function(){let e=Ts[0].or(Ts[1]);return Ts.slice(2).forEach(t=>e=e.or(t)),e})();function yc(e){return Vl.decode(e)}function bc(e){return t=>e.encoder.encode(t)}function Fl(e){if(parseInt(e).toString()!==e)throw new te("Value must be an integer")}function ql(e){if(e<0)throw new te("Value must be a positive integer, or zero")}function Hl(e){return t=>{if(t>e)throw new te(`Value must be smaller than or equal to ${e}`)}}function zl(...e){return t=>{for(let r of e)r(t)}}var Vr=zl(Fl,ql,Hl(65535));var lt=-1,Rs=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new In(`Protocol ${t} was unknown`);return r}addProtocol(t){this.protocolsByCode.set(t.code,t),this.protocolsByName.set(t.name,t),t.aliases?.forEach(r=>{this.protocolsByName.set(r,t)})}removeProtocol(t){let r=this.protocolsByCode.get(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},ee=new Rs,sd=[{code:4,name:"ip4",size:32,valueToBytes:Os,bytesToValue:hc,validate:e=>{if(!rr(e))throw new te(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Ae,bytesToValue:nr,validate:Vr},{code:273,name:"udp",size:16,valueToBytes:Ae,bytesToValue:nr,validate:Vr},{code:33,name:"dccp",size:16,valueToBytes:Ae,bytesToValue:nr,validate:Vr},{code:41,name:"ip6",size:128,valueToBytes:dc,bytesToValue:pc,stringToValue:mc,validate:e=>{if(!Dn(e))throw new te(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:lt},{code:43,name:"ipcidr",size:8,bytesToValue:Ls("base10"),valueToBytes:Bs("base10")},{code:53,name:"dns",size:lt},{code:54,name:"dns4",size:lt},{code:55,name:"dns6",size:lt},{code:56,name:"dnsaddr",size:lt},{code:132,name:"sctp",size:16,valueToBytes:Ae,bytesToValue:nr,validate:Vr},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:lt,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:lt,bytesToValue:Ls("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?Bs("base58btc")(e):at.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Ps,valueToBytes:fc},{code:445,name:"onion3",size:296,bytesToValue:Ps,valueToBytes:lc},{code:446,name:"garlic64",size:lt},{code:447,name:"garlic32",size:lt},{code:448,name:"tls"},{code:449,name:"sni",size:lt},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:lt,bytesToValue:bc(io),valueToBytes:yc},{code:480,name:"http"},{code:481,name:"http-path",size:lt,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:lt}];sd.forEach(e=>{ee.addProtocol(e)});function gc(e){let t=[],r=0;for(;r<e.length;){let n=Tr(e,r),o=ee.getProtocol(n),s=At(n),i=id(o,e,r+s),c=0;i>0&&o.size===lt&&(c=At(i));let a=s+c+i,u={code:n,name:o.name,bytes:e.subarray(r,r+a)};if(i>0){let f=r+s+c,l=e.subarray(f,f+i);u.value=o.bytesToValue?.(l)??H(l)}t.push(u),r+=a}return t}function xc(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=ee.getProtocol(n.code),s=At(n.code),i,c=0,a=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??F(n.value),c=i.byteLength,o.size===lt&&(a=At(c)));let u=new Uint8Array(s+a+c),f=0;Ze(n.code,u,f),f+=s,i!=null&&(o.size===lt&&(Ze(c,u,f),f+=a),u.set(i,f)),n.bytes=u}r.push(n.bytes),t+=n.bytes.byteLength}return $t(r,t)}function wc(e){if(e.charAt(0)!=="/")throw new mt('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let c=s===e.length-1;if(i==="/"||c){let a=ee.getProtocol(o);if(r==="protocol"){if(a.size==null||a.size===0){t.push({code:a.code,name:a.name}),n="",o="",r="protocol";continue}else if(c)throw new mt(`Component ${o} was missing value`);r="value"}else if(r==="value"){let u={code:a.code,name:a.name};if(a.size!=null&&a.size!==0){if(n==="")throw new mt(`Component ${o} was missing value`);u.value=a.stringToValue?.(n)??n}t.push(u),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new mt("Incomplete multiaddr");return t}function Ec(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=ee.getProtocol(t.code);if(r==null)throw new mt(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function id(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:Tr(t,r)}var ad=Symbol.for("nodejs.util.inspect.custom"),Ws=Symbol.for("@multiformats/multiaddr");function cd(e){if(e==null&&(e="/"),vc(e))return e.getComponents();if(e instanceof Uint8Array)return gc(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),wc(e);if(Array.isArray(e))return e;throw new mt("Must be a string, Uint8Array, Component[], or another Multiaddr")}var On=class e{[Ws]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=cd(t),r.validate!==!1&&ud(this)}get bytes(){return this.#r==null&&(this.#r=xc(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=Ec(this.#t)),this.#e}toJSON(){return this.toString()}getComponents(){return[...this.#t.map(t=>({...t}))]}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new Sn(`Address ${this.toString()} does not contain subaddress: ${r}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}equals(t){return ct(this.bytes,t.bytes)}[ad](){return`Multiaddr(${this.toString()})`}};function ud(e){e.getComponents().forEach(t=>{let r=ee.getProtocol(t.code);t.value!=null&&r.validate?.(t.value)})}function vc(e){return!!e?.[Ws]}function De(e){return new On(e)}var Sc="libp2p-peer-record",Ic=Uint8Array.from([3,1]);var qr;(function(e){let t;(function(n){let o;n.codec=()=>(o==null&&(o=Nt((s,i,c={})=>{c.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),c.lengthDelimited!==!1&&i.ldelim()},(s,i,c={})=>{let a={multiaddr:ht(0)},u=i==null?s.len:s.pos+i;for(;s.pos<u;){let f=s.uint32();switch(f>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(f&7);break}}}return a})),o),n.encode=s=>Rt(s,n.codec()),n.decode=(s,i)=>Ot(s,n.codec(),i)})(t=e.AddressInfo||(e.AddressInfo={}));let r;e.codec=()=>(r==null&&(r=Nt((n,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let i of n.addresses)o.uint32(26),e.AddressInfo.codec().encode(i,o);s.lengthDelimited!==!1&&o.ldelim()},(n,o,s={})=>{let i={peerId:ht(0),seq:0n,addresses:[]},c=o==null?n.len:n.pos+o;for(;n.pos<c;){let a=n.uint32();switch(a>>>3){case 1:{i.peerId=n.bytes();break}case 2:{i.seq=n.uint64();break}case 3:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new Ie('Decode error - map field "addresses" had too many elements');i.addresses.push(e.AddressInfo.codec().decode(n,n.uint32(),{limits:s.limits?.addresses$}));break}default:{n.skipType(a&7);break}}}return i})),r),e.encode=n=>Rt(n,e.codec()),e.decode=(n,o)=>Ot(n,e.codec(),o)})(qr||(qr={}));function Ac(e,t){let r=(n,o)=>n.toString().localeCompare(o.toString());return e.length!==t.length?!1:(t.sort(r),e.sort(r).every((n,o)=>t[o].equals(n)))}var Ut=class e{static createFromProtobuf=t=>{let r=qr.decode(t),n=Ds(pr(r.peerId)),o=(r.addresses??[]).map(i=>De(i.multiaddr)),s=r.seq;return new e({peerId:n,multiaddrs:o,seqNumber:s})};static DOMAIN=Sc;static CODEC=Ic;peerId;multiaddrs;seqNumber;domain=e.DOMAIN;codec=e.CODEC;marshaled;constructor(t){let{peerId:r,multiaddrs:n,seqNumber:o}=t;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=o??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=qr.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof e)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!Ac(this.multiaddrs,t.multiaddrs))}};function Rn(e){let t=e.getComponents(),r={},n=0;if(t[n]?.name==="ip6zone"&&(r.zone=`${t[n].value}`,n++),t[n].name==="ip4"||t[n].name==="ip6"||t[n].name==="dns"||t[n].name==="dns4"||t[n].name==="dns6"?(r.type=t[n].name,r.host=t[n].value,n++):t[n].name==="dnsaddr"&&(r.type=t[n].name,r.host=`_dnsaddr.${t[n].value}`,n++),(t[n]?.name==="tcp"||t[n]?.name==="udp")&&(r.protocol=t[n].name==="tcp"?"tcp":"udp",r.port=parseInt(`${t[n].value}`),n++),t[n]?.name==="ipcidr"&&(r.type==="ip4"?r.cidr=parseInt(`${t[n].value}`):r.type==="ip6"&&(r.cidr=`${t[n].value}`),n++),r.type==null||r.host==null)throw new Q(`Multiaddr ${e} was not an IPv4, IPv6, DNS, DNS4, DNS6 or DNSADDR address`);return t[n]?.name==="tls"&&t[n+1]?.name==="sni"&&(r.sni=t[n+1].value,n+=2),r}function _c(e,t,r){let n=0;for(let o of e)if(!(n<t)){if(n>r)break;if(o!==255)return!1;n++}return!0}function Cc(e,t,r,n){let o=0;for(let s of e)if(!(o<r)){if(o>n)break;if(s!==t[o])return!1;o++}return!0}function js(e){switch(e.length){case Te:return e.join(".");case Le:{let t=[];for(let r=0;r<e.length;r++)r%2===0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw new Error("Invalid ip length")}}function Dc(e){let t=0;for(let[r,n]of e.entries()){if(n===255){t+=8;continue}for(;(n&128)!=0;)t++,n=n<<1;if((n&128)!=0)return-1;for(let o=r+1;o<e.length;o++)if(e[o]!=0)return-1;break}return t}function Tc(e){let t="0x";for(let r of e)t+=(r>>4).toString(16)+(r&15).toString(16);return t}var Te=4,Le=16,gg=parseInt("0xFFFF",16),fd=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Hr(e,t){t.length===Le&&e.length===Te&&_c(t,0,11)&&(t=t.slice(12)),t.length===Te&&e.length===Le&&Cc(e,fd,0,11)&&(e=e.slice(12));let r=e.length;if(r!=t.length)throw new Error("Failed to mask ip");let n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e[o]&t[o];return n}function Lc(e,t){if(typeof t=="string"&&(t=er(t)),t==null)throw new Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!==(t[r]&e.mask[r]))return!1;return!0}function Xs(e){let[t,r]=e.split("/");if(!t||!r)throw new Error("Failed to parse given CIDR: "+e);let n=Te,o=_n(t);if(o==null&&(n=Le,o=Cn(t),o==null))throw new Error("Failed to parse given CIDR: "+e);let s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+e);let i=Qs(s,8*n);return{network:Hr(o,i),mask:i}}function Qs(e,t){if(t!==8*Te&&t!==8*Le)throw new Error("Invalid CIDR mask");if(e<0||e>t)throw new Error("Invalid CIDR mask");let r=t/8,n=new Uint8Array(r);for(let o=0;o<r;o++){if(e>=8){n[o]=255,e-=8;continue}n[o]=255-(255>>e),e=0}return n}var zr=class{constructor(t,r){if(r==null)({network:this.network,mask:this.mask}=Xs(t));else{let n=er(t);if(n==null)throw new Error("Failed to parse network");r=String(r);let o=parseInt(r,10);if(Number.isNaN(o)||String(o).length!==r.length||o<0||o>n.length*8){let s=er(r);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=Qs(o,8*n.length);this.network=Hr(n,this.mask)}}contains(t){return Lc({network:this.network,mask:this.mask},t)}toString(){let t=Dc(this.mask),r=t!==-1?String(t):Tc(this.mask);return js(this.network)+"/"+r}};function Bc(e,t){return new zr(e).contains(t)}function Pc(e){try{let t=Rn(e);switch(t.type){case"ip6":return Bc("2000::/3",t.host);default:return!1}}catch{return!1}}var Rc=uu(Oc(),1),ld=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],dd=ld.map(e=>new Rc.Netmask(e));function Js(e){for(let t of dd)if(t.contains(e))return!0;return!1}function hd(e){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)}function pd(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`;return Js(o)}function md(e){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)}function yd(e){let t=e.split(":"),r=t[t.length-1];return Js(r)}function bd(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}function Nc(e){if(rr(e))return Js(e);if(hd(e))return pd(e);if(md(e))return yd(e);if(Dn(e))return bd(e)}function Uc(e){try{let t=Rn(e);switch(t.type){case"ip4":case"ip6":return Nc(t.host)??!1;default:return t.host==="localhost"}}catch{return!1}}function cr(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var ti=class extends Error{constructor(t){super(t),this.name="TimeoutError"}},ei=class extends Error{constructor(t){super(),this.name="AbortError",this.message=t}},Kc=e=>globalThis.DOMException===void 0?new ei(e):new DOMException(e),kc=e=>{let t=e.reason===void 0?Kc("This operation was aborted."):e.reason;return t instanceof Error?t:Kc(t)};function ri(e,t){let{milliseconds:r,fallback:n,message:o,customTimers:s={setTimeout,clearTimeout}}=t,i,c,u=new Promise((f,l)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){let{signal:p}=t;p.aborted&&l(kc(p)),c=()=>{l(kc(p))},p.addEventListener("abort",c,{once:!0})}if(r===Number.POSITIVE_INFINITY){e.then(f,l);return}let h=new ti;i=s.setTimeout.call(void 0,()=>{if(n){try{f(n())}catch(p){l(p)}return}typeof e.cancel=="function"&&e.cancel(),o===!1?f():o instanceof Error?l(o):(h.message=o??`Promise timed out after ${r} milliseconds`,l(h))},r),(async()=>{try{f(await e)}catch(p){l(p)}})()}).finally(()=>{u.clear(),c&&t.signal&&t.signal.removeEventListener("abort",c)});return u.clear=()=>{s.clearTimeout.call(void 0,i),i=void 0},u}var gd=e=>{let t=e.addEventListener||e.on||e.addListener,r=e.removeEventListener||e.off||e.removeListener;if(!t||!r)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};function xd(e,t,r){let n,o=new Promise((s,i)=>{if(r={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...r},!(r.count>=0&&(r.count===Number.POSITIVE_INFINITY||Number.isInteger(r.count))))throw new TypeError("The `count` option should be at least 0 or more");r.signal?.throwIfAborted();let c=[t].flat(),a=[],{addListener:u,removeListener:f}=gd(e),l=async(...p)=>{let d=r.multiArgs?p:p[0];if(r.filter)try{if(!await r.filter(d))return}catch(E){n(),i(E);return}a.push(d),r.count===a.length&&(n(),s(a))},h=(...p)=>{n(),i(r.rejectionMultiArgs?p:p[0])};n=()=>{for(let p of c)f(p,l);for(let p of r.rejectionEvents)c.includes(p)||f(p,h)};for(let p of c)u(p,l);for(let p of r.rejectionEvents)c.includes(p)||u(p,h);r.signal&&r.signal.addEventListener("abort",()=>{h(r.signal.reason)},{once:!0}),r.resolveImmediately&&s(a)});if(o.cancel=n,typeof r.timeout=="number"){let s=ri(o,{milliseconds:r.timeout});return s.cancel=()=>{n(),s.clear()},s}return o}function Mc(e,t,r){typeof r=="function"&&(r={filter:r}),r={...r,count:1,resolveImmediately:!1};let n=xd(e,t,r),o=n.then(s=>s[0]);return o.cancel=n.cancel,o}function Vc(e,t){let r,n=function(){let o=function(){r=void 0,e()};clearTimeout(r),r=setTimeout(o,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}var Be=class extends Error{static name="UnexpectedEOFError";name="UnexpectedEOFError"};function wd(e){return e.reason}async function Fc(e,t,r){if(t==null)return e;let n=r?.translateError??wd;if(t.aborted)return e.catch(()=>{}),Promise.reject(n(t));let o;try{return await Promise.race([e,new Promise((s,i)=>{o=()=>{i(n(t))},t.addEventListener("abort",o)})])}finally{o!=null&&t.removeEventListener("abort",o)}}var vd=4194304,Nn=class extends Error{static name="UnwrappedError";name="UnwrappedError"},oi=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},si=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},ii=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Sd(e){return typeof e?.closeRead=="function"}function Id(e){return typeof e?.close=="function"}function ni(e){return Sd(e)?e.remoteWriteStatus!=="writable"&&e.readBufferLength===0:Id(e)?e.status!=="open":!1}function Ad(e){return e?.addEventListener!=null&&e?.removeEventListener!=null&&e?.send!=null&&e?.push!=null&&e?.log!=null}function _d(e,t){let r=t?.maxBufferSize??vd,n=new it,o,s=!1;if(!Ad(e))throw new Q("Argument should be a Stream or a Multiaddr");let i=f=>{if(n.append(f.data),n.byteLength>r){let l=n.byteLength;n.consume(n.byteLength),o?.reject(new Error(`Read buffer overflow - ${l} > ${r}`))}o?.resolve()};e.addEventListener("message",i);let c=f=>{f.error!=null?o?.reject(f.error):o?.resolve()};e.addEventListener("close",c);let a=()=>{o?.resolve()};e.addEventListener("remoteCloseWrite",a);let u={readBuffer:n,async read(f){if(s===!0)throw new Nn("Stream was unwrapped");if(ni(e)){if(f?.bytes==null)return null;if(n.byteLength<f.bytes)throw e.log.error("closed after reading %d/%d bytes",n.byteLength,f.bytes),new Be(`Unexpected EOF - stream closed after reading ${n.byteLength}/${f.bytes} bytes`)}let l=f?.bytes??1;for(o=Promise.withResolvers();;){if(n.byteLength>=l){o.resolve();break}if(await Fc(o.promise,f?.signal),ni(e)){if(n.byteLength===0&&f?.bytes==null)return null;break}o=Promise.withResolvers()}let h=f?.bytes??n.byteLength;if(n.byteLength<h){if(ni(e))throw e.log.error("closed while reading %d/%d bytes",n.byteLength,h),new Be(`Unexpected EOF - stream closed while reading ${n.byteLength}/${h} bytes`);return u.read(f)}let p=n.sublist(0,h);return n.consume(h),p},async write(f,l){if(s===!0)throw new Nn("Stream was unwrapped");e.send(f)||await Mc(e,"drain",{signal:l?.signal,rejectionEvents:["close"]})},unwrap(){return s||(s=!0,e.removeEventListener("message",i),e.removeEventListener("close",c),e.removeEventListener("remoteCloseWrite",a),n.byteLength>0&&(e.log("stream unwrapped with %d unread bytes",n.byteLength),e.push(n))),e}};return u}function Cd(e,t={}){let r=_d(e,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=At(t.maxDataLength));let n=t?.lengthDecoder??Tr,o=t?.lengthEncoder??Ye;return{async read(i){let c=-1,a=new it;for(;;){let f=await r.read({...i,bytes:1});if(f==null)break;a.append(f);try{c=n(a)}catch(l){if(l instanceof RangeError)continue;throw l}if(c<0)throw new oi("Invalid message length");if(t?.maxLengthLength!=null&&a.byteLength>t.maxLengthLength)throw new ii(`Message length length too long - ${a.byteLength} > ${t.maxLengthLength}`);if(c>-1)break}if(t?.maxDataLength!=null&&c>t.maxDataLength)throw new si(`Message length too long - ${c} > ${t.maxDataLength}`);let u=await r.read({...i,bytes:c});if(u==null)throw e.log.error("tried to read %d bytes but the stream closed",c),new Be(`Unexpected EOF - tried to read ${c} bytes but the stream closed`);if(u.byteLength!==c)throw e.log.error("read %d/%d bytes before the stream closed",u.byteLength,c),new Be(`Unexpected EOF - read ${u.byteLength}/${c} bytes before the stream closed`);return u},async write(i,c){await r.write(new it(o(i.byteLength),i),c)},async writeV(i,c){let a=new it(...i.flatMap(u=>[o(u.byteLength),u]));await r.write(a,c)},unwrap(){return r.unwrap()}}}function ur(e,t){let r=Cd(e,t),n={read:async(o,s)=>{let i=await r.read(s);return o.decode(i)},write:async(o,s,i)=>{await r.write(s.encode(o),i)},writeV:async(o,s,i)=>{await r.writeV(o.map(c=>s.encode(c)),i)},pb:o=>({read:async s=>n.read(o,s),write:async(s,i)=>n.write(s,o,i),writeV:async(s,i)=>n.writeV(s,o,i),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}function Dd(e){return e[Symbol.asyncIterator]!=null}function Td(e){if(Dd(e))return(async()=>{for await(let t of e);})();for(let t of e);}var qc=Td;var Un=globalThis.CustomEvent??Event;async function*ai(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);let n=t.ordered??!1,o=new EventTarget,s=[],i=cr(),c=cr(),a=!1,u,f=!1;o.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(async()=>{try{for await(let d of e){if(s.length===r&&(i=cr(),await i.promise),f)break;let E={done:!1};s.push(E),d().then(S=>{E.done=!0,E.ok=!0,E.value=S,o.dispatchEvent(new Un("task-complete"))},S=>{E.done=!0,E.err=S,o.dispatchEvent(new Un("task-complete"))})}a=!0,o.dispatchEvent(new Un("task-complete"))}catch(d){u=d,o.dispatchEvent(new Un("task-complete"))}});function l(){return n?s[0]?.done:!!s.find(d=>d.done)}function*h(){for(;s.length>0&&s[0].done;){let d=s[0];if(s.shift(),d.ok)yield d.value;else throw f=!0,i.resolve(),d.err;i.resolve()}}function*p(){for(;l();)for(let d=0;d<s.length;d++)if(s[d].done){let E=s[d];if(s.splice(d,1),d--,E.ok)yield E.value;else throw f=!0,i.resolve(),E.err;i.resolve()}}for(;;){if(l()||(c=cr(),await c.promise),u!=null||(n?yield*h():yield*p(),u!=null))throw u;if(a&&s.length===0)break}}var Hc="0.1.0";var zc="id/push",$c="1.0.0",Gc="1.0.0";var de;(function(e){let t;e.codec=()=>(t==null&&(t=Nt((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.protocolVersion!=null&&(n.uint32(42),n.string(r.protocolVersion)),r.agentVersion!=null&&(n.uint32(50),n.string(r.agentVersion)),r.publicKey!=null&&(n.uint32(10),n.bytes(r.publicKey)),r.listenAddrs!=null)for(let s of r.listenAddrs)n.uint32(18),n.bytes(s);if(r.observedAddr!=null&&(n.uint32(34),n.bytes(r.observedAddr)),r.protocols!=null)for(let s of r.protocols)n.uint32(26),n.string(s);r.signedPeerRecord!=null&&(n.uint32(66),n.bytes(r.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={listenAddrs:[],protocols:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 5:{s.protocolVersion=r.string();break}case 6:{s.agentVersion=r.string();break}case 1:{s.publicKey=r.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&s.listenAddrs.length===o.limits.listenAddrs)throw new Ie('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(r.bytes());break}case 4:{s.observedAddr=r.bytes();break}case 3:{if(o.limits?.protocols!=null&&s.protocols.length===o.limits.protocols)throw new Ie('Decode error - map field "protocols" had too many elements');s.protocols.push(r.string());break}case 8:{s.signedPeerRecord=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Rt(r,e.codec()),e.decode=(r,n)=>Ot(r,e.codec(),n)})(de||(de={}));var _t={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function Zc(e){if(e!=null&&e.length>0)try{return De(e)}catch{}}async function Kn(e,t,r,n,o){if(r("received identify from %p",n.remotePeer),o==null)throw new Tt("message was null or undefined");let s={};if(o.listenAddrs.length>0&&(s.addresses=o.listenAddrs.map(a=>({isCertified:!1,multiaddr:De(a)}))),o.protocols.length>0&&(s.protocols=o.protocols),o.publicKey!=null){let a=Je(o.publicKey);if(!cc(a).equals(n.remotePeer))throw new Tt("public key did not match remote PeerId");s.publicKey=a}let i;if(o.signedPeerRecord!=null){r.trace("received signedPeerRecord from %p",n.remotePeer);let a=o.signedPeerRecord,u=await Ht.openAndCertify(a,Ut.DOMAIN),f=Ut.createFromProtobuf(u.payload),l=vn(u.publicKey.toCID());if(!f.peerId.equals(l))throw new Tt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(f.peerId))throw new Tt("signing key does not match remote PeerId");let h;try{h=await e.get(f.peerId)}catch(p){if(p.name!=="NotFoundError")throw p}if(h!=null&&(s.metadata=h.metadata,h.peerRecordEnvelope!=null)){let p=Ht.createFromProtobuf(h.peerRecordEnvelope),d=Ut.createFromProtobuf(p.payload);d.seqNumber>=f.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",d.seqNumber,f.seqNumber),f=d,a=h.peerRecordEnvelope)}s.peerRecordEnvelope=a,s.addresses=f.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),i={seq:f.seqNumber,addresses:f.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,s),await e.patch(n.remotePeer,s),o.agentVersion!=null||o.protocolVersion!=null){let a={};o.agentVersion!=null&&(a.AgentVersion=F(o.agentVersion)),o.protocolVersion!=null&&(a.ProtocolVersion=F(o.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,a),await e.merge(n.remotePeer,{metadata:a})}let c={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(a=>De(a)),observedAddr:o.observedAddr==null?void 0:De(o.observedAddr),protocols:o.protocols,signedPeerRecord:i,connection:n};return t.safeDispatchEvent("peer:identify",{detail:c}),c}var fr=class{host;components;protocol;started;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;runOnLimitedConnection;log;constructor(t,r){this.protocol=r.protocol,this.started=!1,this.components=t,this.log=r.log,this.timeout=r.timeout??_t.timeout,this.maxInboundStreams=r.maxInboundStreams??_t.maxInboundStreams,this.maxOutboundStreams=r.maxOutboundStreams??_t.maxOutboundStreams,this.maxMessageSize=r.maxMessageSize??_t.maxMessageSize,this.maxObservedAddresses=r.maxObservedAddresses??_t.maxObservedAddresses,this.runOnLimitedConnection=r.runOnLimitedConnection??_t.runOnLimitedConnection,this.host={protocolVersion:`${r.protocolPrefix??_t.protocolPrefix}/${Hc}`,agentVersion:t.nodeInfo.userAgent},this.handleProtocol=this.handleProtocol.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.merge(this.components.peerId,{metadata:{AgentVersion:F(this.host.agentVersion),ProtocolVersion:F(this.host.protocolVersion)}}),await this.components.registrar.handle(this.protocol,this.handleProtocol,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}};var kn=class extends fr{connectionManager;concurrency;_push;constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??_t.protocolPrefix}/${zc}/${Gc}`,log:t.logger.forComponent("libp2p:identify-push")}),this.connectionManager=t.connectionManager,this.concurrency=r.concurrency??_t.concurrency,this._push=Vc(this.sendPushMessage.bind(this),r.debounce??1e3),(r.runOnSelfUpdate??_t.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error("error pushing updates to peers - %e",o)})})}[Xr]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{let t=this.components.addressManager.getAddresses().map(f=>f.decapsulateCode(421)),r=new Ut({peerId:this.components.peerId,multiaddrs:t}),n=await Ht.seal(r,this.components.privateKey),o=this.components.registrar.getProtocols(),s=await this.components.peerStore.get(this.components.peerId),i=H(s.metadata.get("AgentVersion")??F(this.host.agentVersion)),c=H(s.metadata.get("ProtocolVersion")??F(this.host.protocolVersion)),a=this;async function*u(){for(let f of a.connectionManager.getConnections())(await a.components.peerStore.get(f.remotePeer)).protocols.includes(a.protocol)&&(yield async()=>{let h,p=AbortSignal.timeout(a.timeout);try{h=await f.newStream(a.protocol,{signal:p,runOnLimitedConnection:a.runOnLimitedConnection}),await ur(h,{maxDataLength:a.maxMessageSize}).pb(de).write({listenAddrs:t.map(E=>E.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:i,protocolVersion:c},{signal:p}),await h.close({signal:p})}catch(d){h?.log.newScope("identify-push")?.error("could not push identify update to peer",d),h?.abort(d)}})}await qc(ai(u(),{concurrency:this.concurrency}))}catch(t){this.log.error("error pushing updates to peers - %e",t)}}async handleProtocol(t,r){let n=t.log.newScope("identify-push");if(this.components.peerId.equals(r.remotePeer))throw new Error("received push from ourselves?");let o={signal:AbortSignal.timeout(this.timeout)},i=await ur(t,{maxDataLength:this.maxMessageSize}).pb(de).read(o);await t.close(o),await Kn(this.components.peerStore,this.components.events,n,r,i),n.trace("handled push from %p",r.remotePeer)}};var Y=e=>({match:t=>{let r=t[0];return r==null||r.code!==e||r.value!=null?!1:t.slice(1)}}),P=(e,t)=>({match:r=>{let n=r[0];return n?.code!==e||n.value==null||t!=null&&n.value!==t?!1:r.slice(1)}}),Yc=e=>({match:t=>e.match(t)===!1?t:!1}),q=e=>({match:t=>{let r=e.match(t);return r===!1?t:r}}),xt=(...e)=>({match:t=>{let r;for(let n of e){let o=n.match(t);o!==!1&&(r==null||o.length<r.length)&&(r=o)}return r??!1}}),Z=(...e)=>({match:t=>{for(let r of e){let n=r.match(t);if(n===!1)return!1;t=n}return t}});function W(...e){function t(o){if(o==null)return!1;let s=o.getComponents();for(let i of e){let c=i.match(s);if(c===!1)return!1;s=c}return s}function r(o){return t(o)!==!1}function n(o){let s=t(o);return s===!1?!1:s.length===0}return{matchers:e,matches:r,exactMatch:n}}var Od=P(421),Jx=W(Od),Vn=P(54),Fn=P(55),qn=P(56),ui=P(53),tw=W(Vn,q(P(421))),ew=W(Fn,q(P(421))),rw=W(qn,q(P(421))),nw=W(xt(ui,qn,Vn,Fn),q(P(421))),Wc=Z(P(4),q(P(43))),jc=Z(q(P(42)),P(41),q(P(43))),fi=xt(Wc,jc),Pe=xt(fi,ui,Vn,Fn,qn),Xc=W(xt(fi,Z(xt(ui,qn,Vn,Fn),q(P(421))))),ow=W(Wc),sw=W(jc),iw=W(fi),li=Z(Pe,P(6)),Gr=Z(Pe,P(273)),Qc=W(Z(li,q(P(421)))),aw=W(Gr),di=Z(Gr,Y(460),q(P(421))),Hn=Z(Gr,Y(461),q(P(421))),Rd=xt(di,Hn),cw=W(di),uw=W(Hn),ci=xt(Pe,li,Gr,di,Hn),Jc=xt(Z(ci,Y(477),q(P(421)))),fw=W(Jc),tu=xt(Z(ci,Y(478),q(P(421))),Z(ci,Y(448),q(P(449)),Y(477),q(P(421)))),lw=W(tu),eu=Z(Gr,Y(280),q(P(466)),q(P(466)),q(P(421))),dw=W(eu),ru=Z(Hn,Y(465),q(P(466)),q(P(466)),q(P(421))),hw=W(ru),Mn=xt(Jc,tu,Z(li,q(P(421))),Z(Rd,q(P(421))),Z(Pe,q(P(421))),eu,ru,P(421)),pw=W(Mn),Nd=Z(q(Mn),Y(290),Yc(Y(281)),q(P(421))),mw=W(Nd),Ud=xt(Z(Mn,Y(290),Y(281),q(P(421))),Z(Mn,Y(281),q(P(421))),Z(Y(281),q(P(421)))),yw=W(Ud),Kd=xt(Z(Pe,P(6),Y(480),q(P(421))),Z(Pe,Y(480),q(P(421)))),bw=W(Kd),kd=Z(Pe,xt(Z(P(6,"443"),Y(480)),Z(P(6),Y(443)),Z(P(6),Y(448),Y(480)),Z(Y(448),Y(480)),Y(448),Y(443)),q(P(421))),gw=W(kd),Md=xt(Z(P(777),q(P(421)))),xw=W(Md),Vd=xt(Z(P(400),q(P(421)))),ww=W(Vd);var zn=class extends fr{constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??_t.protocolPrefix}/${"id"}/${$c}`,log:t.logger.forComponent("libp2p:identify")}),(r.runOnConnectionOpen??_t.runOnConnectionOpen)&&t.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(()=>{})})}[Xr]=["@libp2p/identify"];async _identify(t,r={}){let n,o;if(r.signal==null){let s=AbortSignal.timeout(this.timeout);r={...r,signal:s}}this.log("run identify on new connection %a",t.remoteAddr);try{n=await t.newStream(this.protocol,{...r,runOnLimitedConnection:this.runOnLimitedConnection}),o=n.log.newScope("identify");let s=ur(n,{maxDataLength:this.maxMessageSize}).pb(de),i=await s.read(r);return await s.unwrap().unwrap().close(r),i}catch(s){throw o?.error("identify failed - %e",s),n?.abort(s),s}}async identify(t,r={}){let n=await this._identify(t,r),{publicKey:o,protocols:s,observedAddr:i}=n;if(o==null)throw new Tt("Public key was missing from identify message");let c=Je(o),a=vn(c.toCID());if(!t.remotePeer.equals(a))throw new Tt("Identified peer does not match the expected peer");if(this.components.peerId.equals(a))throw new Tt("Identified peer is our own peer id?");return this.maybeAddObservedAddress(i),this.log("completed for peer %p and protocols %o",a,s),Kn(this.components.peerStore,this.components.events,this.log,t,n)}maybeAddObservedAddress(t){let r=Zc(t);if(r==null||(this.log.trace("our observed address was %a",r),Uc(r)))return;let n=r.getComponents();if((n[0].code===41||n[0].code===42&&n[1].code===41)&&!Pc(r)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Qc.exactMatch(r)||(this.log.trace("storing the observed address"),this.components.addressManager.addObservedAddr(r))}async handleProtocol(t,r){let n=t.log.newScope("identify");n("responding to identify");let o=AbortSignal.timeout(this.timeout);let s=await this.components.peerStore.get(this.components.peerId,{signal:o}),i=this.components.addressManager.getAddresses().map(f=>f.decapsulateCode(421)),c=s.peerRecordEnvelope;if(i.length>0&&c==null){let f=new Ut({peerId:this.components.peerId,multiaddrs:i});c=(await Ht.seal(f,this.components.privateKey,{signal:o})).marshal().subarray()}let a=r.remoteAddr.bytes;Xc.matches(r.remoteAddr)||(a=void 0);let u=ur(t).pb(de);n("send response"),await u.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Mt(this.components.privateKey.publicKey),listenAddrs:i.map(f=>f.bytes),signedPeerRecord:c,observedAddr:a,protocols:s.protocols},{signal:o}),n("close write"),await u.unwrap().unwrap().close({signal:o})}};function qd(e={}){return t=>new zn(t,e)}function Hd(e={}){return t=>new kn(t,e)}return fu(zd);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PIdentify}));
//# sourceMappingURL=index.min.js.map
